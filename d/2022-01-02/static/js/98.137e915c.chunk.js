"use strict";(self.webpackChunkremote_faces_web=self.webpackChunkremote_faces_web||[]).push([[98],{82098:(e,t,n)=>{n.r(t),n.d(t,{MediaShare:()=>h,default:()=>v});var a=n(56167),r=n(6925);var s=n(7232),c=n(36620);const i=(e,t,n,i,l)=>{const o=`${l||"mediaShare"}Video`,[u,d]=(0,a.useState)(null),[m,h]=(0,a.useState)({}),v=(0,a.useRef)([]);(0,a.useEffect)((()=>()=>{v.current.forEach((e=>e()))}),[]);const f=(0,r.RK)((0,c.V)(e,t).trackMap);return Object.entries(f[o]||{}).forEach((e=>{var t;let[n,a]=e;if("ended"===a.readyState)return;if(null!==(t=m[n])&&void 0!==t&&t.getTracks().includes(a))return;h((e=>({...e,[n]:new MediaStream([a])})));const r=()=>{h((e=>({...e,[n]:null})))};a.addEventListener("ended",r),v.current.push((()=>{a.removeEventListener("ended",r)}))})),(0,a.useEffect)((()=>{const n=(0,c.V)(e,t);return n.addMediaType(o),()=>{n.removeMediaType(o)}}),[e,t,o]),(0,a.useEffect)((()=>{const a=(0,c.V)(e,t);let r=null;return n&&(async()=>{let e;if("SCREEN"===n){const t=await(async()=>{try{const e={video:!0},t=await navigator.mediaDevices.getDisplayMedia(e),[n]=t.getVideoTracks();return{stream:t,dispose:()=>{n.stop()}}}catch(e){return null}})();if(!t)return void i();e=t}else e=await(0,s.a)(n.video);const[t]=e.stream.getVideoTracks();a.addTrack(o,t),d(e.stream),t.addEventListener("ended",(()=>{r&&r(),r=null}));const c=()=>{a.removeTrack(o),e.dispose(),d(null),i()};!1===r?c():r=c})(),()=>{r&&r(),r=!1}}),[e,t,o,n,i]),{videoStream:u,videoStreamMap:m}};var l=n(54835),o=n(50634);const u=(e,t)=>{const[n,r]=(0,a.useState)({});return(0,a.useEffect)((()=>{const n=(0,c.V)(e,t).ydoc.getMap("faceImages"),a=()=>{r((e=>{const a={...e};let r=!1;return n.forEach(((e,n)=>{var s;n!==t&&(s=e,(0,o.Kn)(s)&&(0,o.Kn)(s.info)&&"string"===typeof s.info.nickname&&(a[n]?e.info.nickname!==a[n]&&(a[n]=e.info.nickname,r=!0):(a[n]=e.info.nickname,r=!0)))})),r?a:e}))};return n.observe(a),a(),()=>{n.unobserve(a)}}),[e,t]),n};var d=n(37878);const m=(0,a.memo)((e=>{let{nickname:t,stream:n}=e;const r=(0,a.useRef)(null);return(0,a.useEffect)((()=>{n&&r.current&&(r.current.srcObject=n)}),[n]),(0,d.jsxs)("div",{className:"MediaShare-card",children:[(0,d.jsx)("video",{className:"MediaShare-video",ref:r,autoPlay:!0,muted:!0}),(0,d.jsx)("div",{className:"MediaShare-nickname",children:t})]})})),h=(0,a.memo)((e=>{let{roomId:t,userId:n,nickname:r,uniqueId:s}=e;const c=(0,l.k)(),[o,h]=(0,a.useState)(""),[v,f]=(0,a.useState)(null),p=(0,a.useCallback)((()=>{f(null)}),[]),{videoStream:S,videoStreamMap:k}=i(t,n,v,p,s),y=u(t,n),[b,j]=(0,a.useState)("grid"),g=(S?1:0)+Object.values(k).filter((e=>e)).length,x=Math.ceil(Math.sqrt(g)),E=Math.ceil(g/x),M="grid"===b?{gridTemplateColumns:`repeat(${x}, 1fr)`,gridTemplateRows:`repeat(${E}, ${100/E}%)`}:{gridTemplateRows:Array(g).fill("100%").join(" ")},C=(0,a.useRef)(null),[w,N]=(0,a.useState)(!1);return(0,d.jsxs)("div",{className:"MediaShare-container",ref:C,children:[(0,d.jsxs)("div",{className:"MediaShare-toolbar",children:[!w&&(0,d.jsx)("button",{type:"button",onClick:async()=>{if(C.current)try{await C.current.requestFullscreen(),N(!0),C.current.onfullscreenchange=()=>{N(document.fullscreenElement===C.current)}}catch(e){}},children:"Enter Fullscreen"}),w&&(0,d.jsx)("button",{type:"button",onClick:async()=>{try{document.exitFullscreen(),N(!1)}catch(e){}},children:"Exit Fullscreen"}),(0,d.jsxs)("select",{value:b,onChange:e=>j(e.target.value),children:[(0,d.jsx)("option",{value:"grid",children:"Display in Grid"}),(0,d.jsx)("option",{value:"vertical",children:"Display Vertically"})]}),null!==v&&(0,d.jsx)("button",{type:"button",onClick:p,children:"Stop sharing"}),null===v&&(0,d.jsx)("button",{type:"button",onClick:()=>f("SCREEN"),children:"Start Screen Share"}),null===v&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("select",{value:o,onChange:e=>h(e.target.value),children:[(0,d.jsx)("option",{value:"",disabled:!0,children:"Select Camera to Share"}),c.map((e=>(0,d.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))]}),o&&(0,d.jsx)("button",{type:"button",onClick:()=>f({video:o}),children:"Start Video Share"})]})]}),(0,d.jsxs)("div",{className:"MediaShare-body",style:M,children:[S&&(0,d.jsx)(m,{nickname:r,stream:S}),Object.keys(k).map((e=>{const t=k[e];return t?(0,d.jsx)(m,{nickname:y[e]||"No Name",stream:t},e):null}))]})]})})),v=h}}]);
//# sourceMappingURL=98.137e915c.chunk.js.map