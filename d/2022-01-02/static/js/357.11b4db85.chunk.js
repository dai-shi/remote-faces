"use strict";(self.webpackChunkremote_faces_web=self.webpackChunkremote_faces_web||[]).push([[357],{5357:(e,t,o)=>{o.r(t),o.d(t,{GoBoard:()=>u,default:()=>a});var n=o(56167),r=o(35739),s=o(36620);const i=(e,t,o,i)=>{const c=`${i||"go"}Board`;(0,n.useEffect)((()=>{const n=(0,s.V)(e,t).ydoc.getArray(c),i=()=>{o(n.toArray().flatMap((e=>{try{const t=JSON.parse(e);if((e=>{try{const t=e;return"number"===typeof t.size&&t.grid.length===t.size*t.size&&!t.grid.some((e=>e!==r.Color.B&&e!==r.Color.W&&e!==r.Color.E))&&"number"===typeof t.capCount.black&&"number"===typeof t.capCount.white&&(t.turn===r.Color.B||t.turn===r.Color.W)}catch(t){return!1}})(t))return[t]}catch(t){}return[]})))};return n.observe(i),i(),()=>{n.unobserve(i)}}),[e,t,o,c]);return{syncUp:(0,n.useCallback)((o=>{const n=(0,s.V)(e,t).ydoc.getArray(c);n.length<o.length?n.push(o.slice(n.length).map((e=>JSON.stringify(e)))):n.length>o.length&&n.delete(o.length,n.length-o.length)}),[e,t,c])}};var c=o(37878);const l=e=>{const t=new r.Position(e.size);return t.grid=e.grid,t.capCount=e.capCount,t.turn=e.turn,t},u=(0,n.memo)((e=>{let{roomId:t,userId:o,uniqueId:s}=e;const u=(0,n.useRef)(),a=(0,n.useMemo)((()=>{const e=t=>{t.length&&(u.current?u.current.syncDown(t):setTimeout((()=>{e(t)}),1e3))};return e}),[]),{syncUp:d}=i(t,o,a,s),[p,h]=(0,n.useState)("black"),[b,g]=(0,n.useState)({black:0,white:0}),C=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(C.current){var e;const t=C.current,o=((e,t,o,n)=>{const s=new r.Game(6),i=new r.SVGBoard(e,{width:e.clientWidth,height:e.clientHeight,size:6});let c=[],u=null;const a=()=>{c=c.filter((e=>s.getStone(e.x,e.y)===("B"===e.type?r.Color.B:r.Color.W)||(i.removeObject(e),!1))),u&&i.removeObject(u),u=null;for(let e=0;e<s.position.size;e+=1)for(let t=0;t<s.position.size;t+=1){const o=s.position.get(e,t);if(o&&!c.some((n=>n.x===e&&n.y===t&&o===("B"===n.type?r.Color.B:r.Color.W)))){const n=new r.FieldBoardObject(o===r.Color.B?"B":"W",e,t);i.addObject(n),c.push(n),null===u?(u=new r.MarkupBoardObject("SQ",e,t,o),i.addObject(u)):u&&(i.removeObject(u),u=!1)}}};let d=null;const p=()=>{d&&(i.removeObject(d),d=null)};return i.on("mousemove",((e,t)=>{if(t&&s.isValid(t.x,t.y)){if(d){if(d.x===t.x&&d.y===t.y)return;i.removeObject(d)}else d=new r.FieldBoardObject(s.turn===r.Color.B?"B":"W");d.setPosition(t.x,t.y),i.addObject(d)}else p()})),i.on("mouseout",p),i.on("click",((e,i)=>{let{x:c,y:l}=i;s.isValid(c,l)&&(p(),s.play(c,l),a(),t(s.turn===r.Color.B?"black":"white"),o(s.position.capCount),n(s.positionStack))})),t(s.turn===r.Color.B?"black":"white"),{syncDown:e=>{if(s.positionStack.length!==e.length){for(;s.positionStack.length<e.length;)s.pushPosition(l(e[s.positionStack.length]));for(;s.positionStack.length>e.length;)s.popPosition();a(),t(s.turn===r.Color.B?"black":"white"),o(s.position.capCount),p()}},pass:()=>{s.pass(),t(s.turn===r.Color.B?"black":"white"),n(s.positionStack)},undo:()=>{s.popPosition()&&(a(),t(s.turn===r.Color.B?"black":"white"),o(s.position.capCount),n(s.positionStack))},resize:()=>{i.setDimensions(e.clientWidth,e.clientHeight)}}})(t,h,g,d);u.current=o;const n=new MutationObserver(o.resize),s=null===(e=t.parentNode)||void 0===e?void 0:e.parentNode;return s&&n.observe(s,{attributes:!0,attributeFilter:["style"]}),()=>{n.disconnect()}}}),[d]);return(0,c.jsxs)("div",{className:"GoBoard-container",children:[(0,c.jsxs)("div",{className:"GoBoard-toolbar",children:["Next Turn: ","black"===p?"Black":"White",(0,c.jsx)("button",{type:"button",onClick:()=>{u.current&&u.current.pass()},children:"Pass"}),(0,c.jsx)("button",{type:"button",onClick:()=>{u.current&&u.current.undo()},children:"Undo"}),(0,c.jsxs)("div",{children:["Capture Count: Black ",b.black,", White ",b.white]})]}),(0,c.jsx)("div",{className:"GoBoard-canvas",ref:C})]})})),a=u}}]);
//# sourceMappingURL=357.11b4db85.chunk.js.map