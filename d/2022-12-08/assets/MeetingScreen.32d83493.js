import{r as a,o as h,a as d,j as u}from"./index.a863bcc5.js";import{u as b,a as g}from"./useNicknameMap.f1857926.js";import"./SingleRoom.8e7c9dce.js";const S=a.exports.memo(({nickname:c,stream:o})=>{const s=a.exports.useRef(null);a.exports.useEffect(()=>()=>{s.current?.close()},[]);const l=a.exports.useCallback(()=>{s.current?.close();const t=h();if(s.current=window.open(`stream_viewer.html#${t}`,"_blank"),!s.current)return;const i=s.current,r=new BroadcastChannel(t),n=new RTCPeerConnection;n.addTrack(o.getVideoTracks()[0],o),n.onicecandidate=e=>{r.postMessage({type:"ice",candidate:e.candidate?.candidate,sdpMid:e.candidate?.sdpMid,sdpMLineIndex:e.candidate?.sdpMLineIndex})},r.onmessage=e=>{if(e.data.type==="ice"){n.addIceCandidate(e.data.candidate?e.data:void 0);return}n.setRemoteDescription(e.data)},i.onload=async()=>{i.document.title=c;const e=await n.createOffer();r.postMessage({type:"offer",sdp:e.sdp}),await n.setLocalDescription(e)}},[c,o]);return d("div",{className:"MeetingScreen-opener",children:d("button",{type:"button",onClick:l,children:c})})}),w=a.exports.memo(({roomId:c,userId:o,nickname:s,uniqueId:l,isActive:t})=>{const[i,r]=a.exports.useState(!1);a.exports.useEffect(()=>{t||r(!1)},[t]);const n=a.exports.useCallback(()=>{r(!1)},[]),{videoStream:e,videoStreamMap:f}=b(c,o,i?"SCREEN":null,n,l),M=g(c,o);return u("div",{className:"MeetingScreen-container",children:[u("div",{className:"MeetingScreen-toolbar",children:[i&&d("button",{type:"button",onClick:n,children:"Stop sharing"}),!i&&d("button",{type:"button",onClick:()=>r(!0),disabled:!t,children:"Start Screen Share"})]}),t&&u("div",{className:"MeetingScreen-body",children:[e&&d(S,{nickname:s,stream:e}),Object.keys(f).map(p=>{const m=f[p];return m?d(S,{nickname:M[p]||"No Name",stream:m},p):null})]})]})});export{w as MeetingScreen,w as default};
