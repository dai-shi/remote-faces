{"version":3,"sources":["utils/types.ts","utils/base64.ts","states/roomMap.ts","utils/sleep.ts","states/roomPresets.ts","hooks/useGatherArea.ts","media/capture.ts","hooks/useFaceImages.ts","media/audio.ts","hooks/useFaceVideos.ts","components/RegionEditor.tsx","components/MySetting.tsx","utils/excalidraw.ts","components/LinkOpener.tsx","components/Loading.tsx","components/FaceCard.tsx","components/FaceList.tsx","components/GatherArea.tsx","components/SingleRoom.tsx","media/video.ts","utils/emoji.ts"],"names":["isObject","x","hasStringProp","prop","hasObjectProp","encodeBase64Async","data","Promise","resolve","reader","FileReader","onload","result","offset","indexOf","slice","readAsDataURL","Blob","decodeBase64Async","base64","a","fetch","response","arrayBuffer","buf","Uint8Array","roomMap","Map","getRoomState","roomId","userId","key","has","state","addMediaType","type","acceptingMediaTypes","includes","console","log","push","roomPromise","acceptMediaTypes","snapshot","removeMediaType","index","splice","addTrack","track","removeTrack","dispose","proxy","networkStatusList","userIdMap","ydoc","ref","Y","trackMap","notifyNewPeer","peerIndex","update","ydocUpdate","then","room","sendData","receiveData","info","on","broadcastData","createRoom","status","Date","toLocaleString","unshift","length","pop","Object","entries","forEach","uid","mediaType","addEventListener","createRoomState","set","get","sleep","ms","setTimeout","createMeeting","i","y","w","h","position","size","zIndex","background","border","iframe","createGoBoard","intro","chat","share","phone","igo","office1","go","go2","office2","office3","movable1","office4","movie","Array","keys","Math","floor","roomPresets","ROOM_STATE_KEY","captureImage","stream","ImageCapture","imageCapture","takePhoto","blob","createImageBitmap","srcImg","grabFrame","srcW","width","srcH","height","video","document","createElement","autoplay","setAttribute","style","display","bottom","body","appendChild","removeChild","srcObject","videoWidth","videoHeight","deviceId","constraints","navigator","mediaDevices","getUserMedia","getVideoTracks","canvas","ctx","getContext","dstW","dstH","ratio","max","min","drawImage","stop","toDataURL","isImageData","image","nickname","message","liveMode","micOn","speakerOn","isFaceInfo","updated","useFaceImages","avatar","statusMesg","suspended","useState","myImage","setMyImage","roomImages","setRoomImages","useEffect","roomState","map","getMap","listener","prev","copied","changed","findIndex","item","tenMinAgo","now","filtered","filter","observe","unsub","subscribe","unobserve","timer","didCleanup","loop","transact","twoMinAgo","value","error","clearTimeout","useFaceImageObsoleted","obsoleted","setObsoleted","callback","setInterval","clearInterval","getAudioStream","audio","getAudioTracks","applyConstraints","echoCancellation","echoCancellationType","ideal","noiseSuppression","addTrackToStream","disposeStream","newStream","MediaStream","dispatchEvent","MediaStreamTrackEvent","getTracks","RegionEditor","React","memo","regionId","setRegionId","setType","left","setLeft","top","setTop","setWidth","setHeight","setZIndex","setBackground","setBorder","setIframe","allRegionData","setAllRegionData","existingRegionIds","className","onChange","e","target","id","loadRegionData","Number","onClick","addRegion","disabled","JSON","stringify","toJSON","loadAllRegionData","parse","MySetting","toggleSuspended","setStatusMesg","setMessage","camera","setCamera","setAvatar","accept","files","file","window","alert","onChangeAvatar","defaultValue","setConfigAvatar","generateExcalidrawURL","importCryptoKey","ROOM_ID_PREFIX_LEN","imported","crypto","subtle","exportKey","k","LinkOpener","excalidrawUrl","setExcalidrawUrl","appLink","location","href","replace","title","readOnly","rel","Loading","FaceCard","inFaceList","muted","updatedDate","firstStatusMesgChar","emoji","String","fromCodePoint","isEmoji","opacity","videoEle","autoPlay","playsInline","src","BLANK_IMAGE","alt","mesg","prompt","getHours","padStart","getMinutes","FaceList","videoDeviceId","useSnapshot","NG_IMAGE","MomentaryChat","lazy","MediaShare","GoBoard","getMicOn","regionMap","Region","boxShadow","highlight","setPosition","registerOnMouseDrag","undefined","onMouseDown","preventDefault","currentTarget","clientX","clientY","frameBorder","fallback","SuspenseFallback","uniqueId","Avatar","GatherArea","audioDeviceId","avatarMap","setAvatarMap","parseInt","myAvatar","setMyAvatar","b","obj","isAvatarData","dataToBroadcast","useRef","current","setRegionMap","next","isRegionData","roomPreset","getRoomPresetFromUrl","preset","timerMap","updateRegion","useCallback","useGatherArea","onMouseDragRef","onMouseMove","activeMeetingRegionId","sort","find","getActiveMeetingRegionId","activeMeetingMicOn","videoEnabled","audioEnabled","uniqueMediaId","videoType","audioType","faceStream","setFaceStream","faceStreamMap","setFaceStreamMap","isMounted","onTrack","readyState","s","oldStream","rest","cleanup","getFaceVideoStream","videoStream","disposeVideo","videoTrack","Event","audioStream","disposeAudio","audioTrack","enabled","onaddtrack","event","kind","removeEventListener","useFaceVideos","showModal","setShowModal","onMouseUp","regionData","avatarData","imageData","SingleRoom","singleRoomState","config","setRoomIdToUrl","toggleConfigTakePhoto","getVideoStream","frameRate","exact","EmojiPicker","Picker","getEmojiDataFromNative"],"mappings":"4HAAA,sGAAO,IAAMA,EAAW,SAACC,GAAD,MACT,kBAANA,GAAwB,OAANA,GAEdC,EAAgB,SAI3BD,EACAE,GAL2B,MAOmB,kBAAtCF,EAA4BE,IAEzBC,EAAgB,SAI3BH,EACAE,GAL2B,OAO3BH,EAAUC,EAA4BE,M,8HCJ3BE,G,MAAoB,SAACC,GAAD,OAC/B,IAAIC,SAAQ,SAACC,GACX,IAAMC,EAAS,IAAIC,WACnBD,EAAOE,OAAS,WACd,IAAMC,EAASH,EAAOG,OAChBC,EAASD,EAAOE,QAAQ,KAAO,EACrCN,EAAQI,EAAOG,MAAMF,KAEvBJ,EAAOO,cAAc,IAAIC,KAAK,CAACX,UAGtBY,EAAiB,uCAAG,WAAOC,GAAP,iBAAAC,EAAA,sEACRC,MAAM,wCAAD,OACcF,IAFX,cACzBG,EADyB,gBAIbA,EAASC,cAJI,cAIzBC,EAJyB,yBAKxB,IAAIC,WAAWD,IALS,2CAAH,sDC0GxBE,EAAU,IAAIC,IAEPC,EAAe,SAACC,EAAgBC,GAC3C,IAAMC,EAAG,UAAMF,EAAN,YAAgBC,GACzB,IAAKJ,EAAQM,IAAID,GAAM,CACrB,IAAME,EAjHc,SAACJ,EAAgBC,GACvC,IAAMI,EAAY,uCAAG,WAAOC,GAAP,SAAAf,EAAA,0DACfa,EAAMG,oBAAoBC,SAASF,GADpB,uBAEjBG,QAAQC,IAAI,2BAA4BJ,GAFvB,iCAKnBF,EAAMG,oBAAoBI,KAAKL,GALZ,SAMAM,EANA,cAOdC,iBAAiBC,mBAASV,EAAMG,sBAPlB,2CAAH,sDASZQ,EAAe,uCAAG,WAAOT,GAAP,eAAAf,EAAA,0DAEP,KADTyB,EAAQZ,EAAMG,oBAAoBtB,QAAQqB,IAD1B,uBAGpBG,QAAQC,IAAI,2BAA4BJ,GAHpB,iCAMtBF,EAAMG,oBAAoBU,OAAOD,EAAO,GANlB,SAOHJ,EAPG,cAQjBC,iBAAiBC,mBAASV,EAAMG,sBARf,2CAAH,sDAUfW,EAAQ,uCAAG,WAAOZ,EAAca,GAArB,SAAA5B,EAAA,sEACIqB,EADJ,cAEVM,SAASZ,EAAMa,GAFL,2CAAH,wDAIRC,EAAW,uCAAG,WAAOd,GAAP,SAAAf,EAAA,sEACCqB,EADD,cAEbQ,YAAYd,GAFC,2CAAH,sDAIXe,EAAO,uCAAG,sBAAA9B,EAAA,sEACKqB,EADL,cAETS,UAFS,2CAAH,qDAIPjB,EAAQkB,gBAAiB,CAC7BC,kBAAmB,GACnBC,UAAW,GACXC,KAAMC,cAAI,IAAIC,KACdpB,oBAAqB,GACrBqB,SAAU,GACVvB,eACAU,kBACAG,WACAE,cACAC,YAkBIQ,EAAa,uCAAG,WAAOC,GAAP,mBAAAvC,EAAA,6DACdwC,EAASJ,IAAsBvB,EAAMqB,MADvB,SAECjD,EAAkBuD,GAFnB,OAEdzC,EAFc,OAGdb,EAAO,CAAEuD,WAAY1C,GAC3BsB,EAAYqB,MAAK,SAACC,GAEhBA,EAAKC,SAAS1D,EAAMqD,MANF,2CAAH,sDASbM,EAAW,uCAAG,WAAO3D,EAAW4D,GAAlB,eAAA9C,EAAA,yDAClBa,EAAMoB,UAAUa,EAAKpC,QAAUoC,EAAKP,YADlB,OAEdrD,QAFc,IAEdA,OAFc,EAEdA,EAAMuD,YAFQ,gCAGK3C,EAAkBZ,EAAKuD,YAH5B,OAGVD,EAHU,OAIhBJ,IAAcvB,EAAMqB,KAAMM,GAJV,2CAAH,wDAOjB3B,EAAMqB,KAAKa,GAAG,SAAd,uCAAwB,WAAOP,GAAP,eAAAxC,EAAA,sEACDf,EAAkBuD,GADjB,OAChBzC,EADgB,OAEtBsB,EAAYqB,MAAK,SAACC,GAChBA,EAAKK,cAAc,CAAEP,WAAY1C,OAHb,2CAAxB,uDAMA,IAeMsB,EAAc4B,YAClBxC,EACAC,GAvD0B,SAACwC,GAC3BhC,QAAQC,KAAI,IAAIgC,MAAOC,iBAAkB,mBAAoBF,GAC7DrC,EAAMmB,kBAAkBqB,QAAQH,GAC5BrC,EAAMmB,kBAAkBsB,OAAS,IACnCzC,EAAMmB,kBAAkBuB,MAEL,uBAAX,OAANL,QAAM,IAANA,OAAA,EAAAA,EAAQnC,OACVyC,OAAOC,QAAQ5C,EAAMoB,WAAWyB,SAAQ,YAAiB,IAAD,mBAAdC,EAAc,YAC1CT,EAAOX,YACjB1B,EAAMoB,UAAU0B,GAAO,eAgD7BrB,EACAO,GApBmB,SACnBe,EACAhC,EACAkB,GAEKjC,EAAMwB,SAASuB,KAClB/C,EAAMwB,SAASuB,GAAa,IAE9BhC,EAAMiC,iBAAiB,SAAS,WAC1BhD,EAAMwB,SAASuB,GAAWd,EAAKpC,UAAYkB,UACtCf,EAAMwB,SAASuB,GAAWd,EAAKpC,WAG1CG,EAAMwB,SAASuB,GAAWd,EAAKpC,QAAUyB,cAAIP,MAU/C,OAAOf,EAQSiD,CAAgBrD,EAAQC,GACtCJ,EAAQyD,IAAIpD,EAAKE,GAEnB,OAAOP,EAAQ0D,IAAIrD,K,iCC5IrB,kCAAO,IAAMsD,EAAQ,SAACC,GAAD,OACnB,IAAI/E,SAAQ,SAACC,GAAD,OAAa+E,WAAW/E,EAAS8E,Q,wMCCzCE,EAAgB,SACpBC,EACAxF,EACAyF,EACAC,EACAC,GALoB,uCAOTH,GAAM,CACftD,KAAM,UACN0D,SAAU,CAAC5F,EAAGyF,GACdI,KAAM,CAACH,EAAGC,GACVG,OAAQ,EACRC,WAAY,GACZC,OAAQ,GACRC,OAAQ,MAINC,EAAgB,SAACV,EAAWxF,EAAWyF,GAAvB,mDACPD,GAAM,CACjBtD,KAAM,UACN0D,SAAU,CAAC5F,EAAGyF,GACdI,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,GACZC,OAAQ,GACRC,OAAQ,KARU,8BAUVT,GAAM,CACdtD,KAAM,UACN0D,SAAU,CAAC5F,EAAGyF,GACdI,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,2BACZC,OAAQ,GACRC,OAAQ,KAjBU,GAqBhBE,EAAiC,qCACrCJ,WAAY,CACV7D,KAAM,aACN0D,SAAU,CAAC,GAAI,IACfC,KAAM,CAAC,IAAK,KACZC,QAAS,IACTC,WACE,uudACFC,OAAQ,GACRC,OAAQ,IAEVG,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,2BACZC,OAAQ,GACRC,OAAQ,KAEPV,EAAc,EAAG,IAAK,GAAI,IAAK,MAC/BA,EAAc,EAAG,IAAK,GAAI,IAAK,MArBG,IAsBrCc,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,uBACZC,OAAQ,GACRC,OAAQ,MAINK,EAAiC,2BAClCf,EAAc,EAAG,GAAI,GAAI,GAAI,MADK,IAErCc,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,IAAK,IAChBC,KAAM,CAAC,IAAM,KACbC,OAAQ,EACRC,WAAY,uBACZC,OAAQ,GACRC,OAAQ,MAINM,EAA+B,6GACnCH,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,2BACZC,OAAQ,GACRC,OAAQ,KAEPC,EAAc,EAAG,IAAK,KACtBA,EAAc,EAAG,IAAK,MACtBA,EAAc,EAAG,IAAK,MACtBA,EAAc,EAAG,IAAK,KACtBA,EAAc,EAAG,IAAK,MACtBA,EAAc,EAAG,IAAK,MACtBA,EAAc,EAAG,IAAK,KACtBA,EAAc,EAAG,IAAK,MACtBA,EAAc,EAAG,IAAK,MAGrBM,EAAmC,iDACvCT,WAAY,CACV7D,KAAM,aACN0D,SAAU,CAAC,EAAG,GACdC,KAAM,CAAC,KAAM,KACbC,QAAS,IACTC,WACE,0IACFC,OAAQ,GACRC,OAAQ,IAEVG,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,QACZC,OAAQ,oBACRC,OAAQ,KAEPV,EAAc,EAAG,GAAI,IAAK,IAAK,MAC/BA,EAAc,EAAG,IAAK,GAAI,IAAK,MAC/BA,EAAc,EAAG,IAAK,IAAK,IAAK,KAtBI,IAuBvCc,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,uBACZC,OAAQ,GACRC,OAAQ,IAEVQ,GAAI,CACFvE,KAAM,UACN0D,SAAU,CAAC,IAAK,IAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,oBACZC,OAAQ,GACRC,OAAQ,IAEVS,IAAK,CACHxE,KAAM,UACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,sBACZC,OAAQ,GACRC,OAAQ,MAINU,EAAmC,qFACvCZ,WAAY,CACV7D,KAAM,aACN0D,SAAU,CAAC,EAAG,GACdC,KAAM,CAAC,KAAM,KACbC,QAAS,IACTC,WACE,0IACFC,OAAQ,GACRC,OAAQ,IAEVG,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,KAEPV,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,IAAK,GAAI,IAAK,MAC/BA,EAAc,EAAG,GAAI,IAAK,IAAK,KAC/BA,EAAc,EAAG,GAAI,IAAK,IAAK,KAC/BA,EAAc,EAAG,GAAI,IAAK,IAAK,KAzBK,IA0BvCc,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,kBACZC,OAAQ,sBACRC,OAAQ,KAEPC,EAAc,GAAI,IAAK,IAGtBU,EAAmC,qFACvCb,WAAY,CACV7D,KAAM,aACN0D,SAAU,CAAC,EAAG,GACdC,KAAM,CAAC,KAAM,KACbC,QAAS,IACTC,WACE,0IACFC,OAAQ,GACRC,OAAQ,IAEVG,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,KAEPV,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,IAAK,GAAI,IAAK,KAC/BA,EAAc,EAAG,IAAK,GAAI,IAAK,KAC/BA,EAAc,EAAG,IAAK,IAAK,IAAK,KAzBI,IA0BvCc,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,IACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,IAEVQ,GAAI,CACFvE,KAAM,UACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,IAEVY,SAAU,CACR3E,KAAM,aACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,GAAI,IACXC,OAAQ,EACRC,WACE,+IACFC,OAAQ,GACRC,OAAQ,MAINa,EAAmC,6DACvCf,WAAY,CACV7D,KAAM,aACN0D,SAAU,CAAC,EAAG,GACdC,KAAM,CAAC,KAAM,KACbC,QAAS,IACTC,WACE,0IACFC,OAAQ,GACRC,OAAQ,IAEVG,KAAM,CACJlE,KAAM,OACN0D,SAAU,CAAC,GAAI,KACfC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,KAEPV,EAAc,EAAG,IAAK,IAAK,IAAK,MAChCA,EAAc,EAAG,GAAI,IAAK,IAAK,MAC/BA,EAAc,EAAG,IAAK,IAAK,IAAK,KAChCA,EAAc,EAAG,IAAK,IAAK,IAAK,KAvBI,IAwBvCwB,MAAO,CACL7E,KAAM,aACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,IACZC,OAAQ,EACRC,WAAY,GACZC,OAAQ,GACRC,OAAQ,6CAEVI,MAAO,CACLnE,KAAM,QACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,IAEVQ,GAAI,CACFvE,KAAM,UACN0D,SAAU,CAAC,IAAK,KAChBC,KAAM,CAAC,IAAK,KACZC,OAAQ,EACRC,WAAY,wBACZC,OAAQ,oBACRC,OAAQ,MAGZ,YAAIe,MAAM,KAAKC,QAAQpC,SAAQ,SAACW,GAC9B,IAAMxF,EAAI,IAAYwF,EAAI,GAAV,GACVC,EAAI,IAAM,GAAKyB,KAAKC,MAAM3B,EAAI,IACpCsB,EAAQ,QAAD,OAAStB,IAAO,CACrBtD,KAAM,aACN0D,SAAU,CAAC5F,EAAGyF,GACdI,KAAM,CAAC,GAAI,IACXC,OAAQ,EACRC,WACE,+IACFC,OAAQ,GACRC,OAAQ,OAIL,IAAMmB,EAA0D,CACrEjB,QACAG,QACAC,MACAC,UACAG,UACAC,UACAE,WChPWO,EAAiB,kB,yCCtFxBC,EAAY,uCAAG,WAAOC,EAAqBxE,GAA5B,iCAAA5B,EAAA,yDACS,qBAAjBqG,aADQ,wBAEXC,EAAe,IAAID,aAAazE,GAFrB,SAGXqC,YAAM,KAHK,gCAMIqC,EAAaC,YANjB,cAMTC,EANS,iBAOAC,kBAAkBD,GAPlB,QAOfE,EAPe,0EASAJ,EAAaK,YATb,QASfD,EATe,sBAWXE,EAAOF,EAAOG,MACdC,EAAOJ,EAAOK,OAZH,kBAaV,CAAEL,SAAQE,OAAME,SAbN,eAebE,EAAQC,SAASC,cAAc,UAC/BC,UAAW,EACjBH,EAAMI,aAAa,cAAe,IAClCJ,EAAMK,MAAMC,QAAU,QACtBN,EAAMK,MAAMR,MAAQ,MACpBG,EAAMK,MAAMN,OAAS,MACrBC,EAAMK,MAAM5C,SAAW,WACvBuC,EAAMK,MAAME,OAAS,IACrBN,SAASO,KAAKC,YAAYT,GACpBlF,EAAU,WACdmF,SAASO,KAAKE,YAAYV,IAE5BA,EAAMW,UAAYvB,EA3BC,UA4BbnC,YAAM,KA5BO,eA6BbyC,EAASM,EACTJ,EAAOI,EAAMY,WACbd,EAAOE,EAAMa,YA/BA,kBAgCZ,CAAEnB,SAAQE,OAAME,OAAMhF,YAhCV,0DAAH,wDAmCLyE,EAAS,uCAAG,WAAOuB,GAAP,mDAAA9H,EAAA,6DACjB+H,EAAc,CAClBf,MAAO,CACLc,WACAjB,MAAO,KACPE,OAAQ,MALW,SAQFiB,UAAUC,aAAaC,aAAaH,GARlC,cAQjB3B,EARiB,SASPA,EAAO+B,iBATA,mBAShBvG,EATgB,KAUjBwG,EAASnB,SAASC,cAAc,UAChCmB,EAAMD,EAAOE,WAAW,MACxBC,EAAO,GACPC,EAAO,GACbJ,EAAOvB,MAAQ0B,EACfH,EAAOrB,OAASyB,EAfO,UAgBuBrC,EAAaC,EAAQxE,GAhB5C,wBAgBf8E,EAhBe,EAgBfA,OAAQE,EAhBO,EAgBPA,KAAME,EAhBC,EAgBDA,KAAMhF,EAhBL,EAgBKA,QACtB2G,EAAQ1C,KAAK2C,IAAIH,EAAO3B,EAAM4B,EAAO1B,GACrCD,EAAQd,KAAK4C,IAAI/B,EAAM2B,EAAOE,GAC9B1B,EAAShB,KAAK4C,IAAI7B,EAAM0B,EAAOC,GAC/B5J,GAAK+H,EAAOC,GAAS,EACrBvC,GAAKwC,EAAOC,GAAU,EAC5BsB,EAAIO,UAAUlC,EAAQ7H,EAAGyF,EAAGuC,EAAOE,EAAQ,EAAG,EAAGwB,EAAMC,GACnD1G,GACFA,IAEFF,EAAMiH,OA1BiB,kBA2BhBT,EAAOU,UAAU,eA3BD,4CAAH,sDCLhBC,EAAc,SAAClK,GAAD,OAClBD,YAASC,IACkC,kBAAnCA,EAAyBmK,OAjBhB,SAACnK,GAAD,OACjBD,YAASC,IACwC,kBAAzCA,EAA4BoK,UACW,kBAAvCpK,EAA2BqK,SACc,mBAAzCrK,EAA4BsK,UACO,mBAAnCtK,EAAyBuK,OACkB,mBAA3CvK,EAA6BwK,UAYrCC,CAAYzK,EAAwBiE,OACW,kBAAvCjE,EAA2B0K,SAExBC,EAAgB,SAC3B/I,EACAC,EACA+I,EACAR,EACAS,EACAC,EACAR,EACAC,EACAC,EACAvB,GACI,IAAD,EAC2B8B,qBAD3B,mBACIC,EADJ,KACaC,EADb,OAEiCF,mBAAsB,IAFvD,mBAEIG,EAFJ,KAEgBC,EAFhB,KAuGH,OAnGAC,qBAAU,WACR,IAAMC,EAAY1J,YAAaC,EAAQC,GACjCyJ,EAAMD,EAAUhI,KAAKkI,OAAO,cAC5BC,EAAW,WACfL,GAAc,SAACM,GACb,IAAMC,EAAM,YAAOD,GACfE,GAAU,EACdL,EAAIzG,SAAQ,SAACxE,EAAMyE,GACjB,GAAIA,IAAQjD,GAGPqI,EAAY7J,GAAjB,CACA,IAAMuC,EAAQ8I,EAAOE,WAAU,SAACC,GAAD,OAAUA,EAAKhK,SAAWiD,MAC1C,IAAXlC,GACF8I,EAAOnJ,KAAKlC,GACZsL,GAAU,GACDtL,EAAKqK,QAAUgB,EAAO9I,GAAO8H,UACtCgB,EAAO9I,GAASvC,EAChBsL,GAAU,OAGd,IAAMG,EAAYxH,KAAKyH,MAAQ,IACzBC,EAAWN,EAAOO,QACtB,SAACJ,GAAD,OACEA,EAAKnB,SAAWoB,GAAaT,EAAUjI,UAAUyI,EAAKhK,WAG1D,OADA8J,EAAUA,GAAWD,EAAOjH,SAAWuH,EAASvH,QAEvCuH,EAEFP,MAGXH,EAAIY,QAAQV,GACZ,IAAMW,EAAQC,oBAAUf,EAAUjI,UAAWoI,GAE7C,OADAA,IACO,WACLW,IACAb,EAAIe,UAAUb,MAEf,CAAC5J,EAAQC,IAEZuJ,qBAAU,WACR,IAGIkB,EAHEjB,EAAY1J,YAAaC,EAAQC,GACjCyJ,EAAMD,EAAUhI,KAAKkI,OAAO,cAC9BgB,GAAa,EAEXC,EAAI,uCAAG,8BAAArL,EAAA,0DACPoL,EADO,8DAGKzB,EAHL,qBAGiBF,EAHjB,uCAGgClD,EAAUuB,GAH1C,8BAGHkB,EAHG,MAILoC,EAJK,mDAKTtB,EAAWd,GAQL9J,EAAkB,CACtBwB,SACAsI,QACAlG,KAVqB,CACrBmG,WACAC,QAASQ,EACTP,WACAC,QACAC,aAMAE,QAASpG,KAAKyH,OAEhBT,EAAIpG,IAAIrD,EAAQxB,GAEhBgL,EAAUhI,KAAKoJ,UAAS,WACtB,IAAMC,EAAYpI,KAAKyH,MAAQ,KAC/BT,EAAIzG,SAAQ,SAAC8H,EAAO7K,GACd6K,EAAMjC,SAAWgC,GACnBpB,EAAIpG,IAAIpD,EAAR,eAAkB6K,UAzBf,kDA8BTtK,QAAQuK,MAAR,MA9BS,QAgCXN,EAAQhH,WAAWkH,EAAM,MAhCd,0DAAH,qDAmCV,OADAA,IACO,WACLD,GAAa,EACbM,aAAaP,MAEd,CACD1K,EACAC,EACAoH,EACA2B,EACAR,EACAS,EACAC,EACAR,EACAC,EACAC,IAGK,CACLQ,UACAE,eAIS4B,EAAwB,SACnCpC,GACI,IAAD,EAC+BK,oBAAS,GADxC,mBACIgC,EADJ,KACeC,EADf,KAcH,OAZA5B,qBAAU,WACR,GAAIV,EAAS,CACX,IAAMuC,EAAW,WACf,IAAMP,EAAYpI,KAAKyH,MAAQ,KAC/BiB,EAAatC,EAAUgC,IAEnBJ,EAAQY,YAAYD,EAAU,KAEpC,OADAA,IACO,kBAAME,cAAcb,OAG5B,CAAC5B,IACGqC,G,6BC9KIK,EAAc,uCAAG,WAAOnE,GAAP,yBAAA9H,EAAA,6DACtB+H,EAAcD,EAChB,CACEoE,MAAO,CAAEpE,aAEX,CAAEoE,OAAO,GALe,SAMPlE,UAAUC,aAAaC,aAAaH,GAN7B,cAMtB3B,EANsB,SAOZA,EAAO+F,iBAPK,mBAOrBvK,EAPqB,cAQtBA,EAAMwK,iBAAiB,CAC3BC,kBAAkB,EAClBC,qBAAsB,CAAEC,MAAO,UAC/BC,iBAAkB,CAAED,OAAO,KAXD,cAatBzK,EAAU,WACdF,EAAMiH,QAdoB,kBAgBrB,CACLzC,SACAtE,YAlB0B,2CAAH,sDCOrB2K,EAAmB,SACvB7K,EACAwE,EACAsG,GAEA,IAAMC,EAAYvG,GAAU,IAAIwG,YAShC,OARAD,EAAUhL,SAASC,GACnB+K,EAAUE,cAAc,IAAIC,sBAAsB,WAAY,CAAElL,WAChEA,EAAMiC,iBAAiB,SAAS,WAC9B8I,EAAU9K,YAAYD,GACe,IAAjC+K,EAAUI,YAAYzJ,QACxBoJ,EAAcC,MAGXA,GCfIK,G,OAAeC,IAAMC,MAG/B,YAAyB,IAAtBzM,EAAqB,EAArBA,OAAQC,EAAa,EAAbA,OAAa,EACOkJ,mBAAS,IADhB,mBAClBuD,EADkB,KACRC,EADQ,OAEDxD,mBAA6B,cAF5B,mBAElB7I,EAFkB,KAEZsM,EAFY,OAGDzD,mBAAS,KAHR,mBAGlB0D,EAHkB,KAGZC,EAHY,OAIH3D,mBAAS,KAJN,mBAIlB4D,EAJkB,KAIbC,EAJa,OAKC7D,mBAAS,KALV,mBAKlB/C,EALkB,KAKX6G,EALW,OAMG9D,mBAAS,KANZ,mBAMlB7C,EANkB,KAMV4G,EANU,OAOG/D,mBAAS,GAPZ,mBAOlBjF,EAPkB,KAOViJ,EAPU,OAQWhE,mBAAS,IARpB,mBAQlBhF,EARkB,KAQNiJ,EARM,OASGjE,mBAAS,IATZ,mBASlB/E,EATkB,KASViJ,EATU,OAUGlE,mBAAS,IAVZ,mBAUlB9E,EAVkB,KAUViJ,EAVU,OA2BiBnE,mBAAwB,MA3BzC,mBA2BlBoE,EA3BkB,KA2BHC,EA3BG,KAkDnBC,EAAiB,YAClB1N,YAAaC,EAAQC,GAAQwB,KAAKkI,OAAOlE,GAAgBJ,QAmB9D,OACE,sBAAKqI,UAAU,yBAAf,UACE,+CACA,+CACa,IACX,uBAAO3C,MAAO2B,EAAUiB,SAAU,SAACC,GAAD,OAAOjB,EAAYiB,EAAEC,OAAO9C,aAEhE,yBACE4C,SAAU,SAACC,IAzBM,SAACE,GAEtB,GADAnB,EAAYmB,GACPA,EAAL,CACA,IAEM/C,EAFYhL,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAChBlC,IAAIuK,GACtBlB,EAAQ7B,EAAMzK,MACdwM,EAAQ/B,EAAM/G,SAAS,IACvBgJ,EAAOjC,EAAM/G,SAAS,IACtBiJ,EAASlC,EAAM9G,KAAK,IACpBiJ,EAAUnC,EAAM9G,KAAK,IACrBkJ,EAAUpC,EAAM7G,QAChBkJ,EAAcrC,EAAM5G,YACpBkJ,EAAUtC,EAAM3G,QAChBkJ,EAAUvC,EAAM1G,SAYV0J,CAAeH,EAAEC,OAAO9C,QAF5B,UAKE,wBAAQA,MAAM,GAAd,8CACC0C,EAAkB/D,KAAI,SAACoE,GAAD,OACrB,wBAAiB/C,MAAO+C,EAAxB,SACGA,GADUA,SAKjB,uBACA,0CACQ,IACN,yBACE/C,MAAOzK,EACPqN,SAAU,SAACC,GAAD,OAAOhB,EAAQgB,EAAEC,OAAO9C,QAFpC,UAIE,wBAAQA,MAAM,aAAd,wBACA,wBAAQA,MAAM,UAAd,qBACA,wBAAQA,MAAM,OAAd,kBACA,wBAAQA,MAAM,QAAd,mBACA,wBAAQA,MAAM,UAAd,4BAGJ,uBACA,0CACQ,IACN,uBACEzK,KAAK,SACLyK,MAAO8B,EACPc,SAAU,SAACC,GAAD,OAAOd,EAAQkB,OAAOJ,EAAEC,OAAO9C,cAG7C,yCACO,IACL,uBACEzK,KAAK,SACLyK,MAAOgC,EACPY,SAAU,SAACC,GAAD,OAAOZ,EAAOgB,OAAOJ,EAAEC,OAAO9C,cAG5C,uBACA,2CACS,IACP,uBACEzK,KAAK,SACLyK,MAAO3E,EACPuH,SAAU,SAACC,GAAD,OAAOX,EAASe,OAAOJ,EAAEC,OAAO9C,cAG9C,4CACU,IACR,uBACEzK,KAAK,SACLyK,MAAOzE,EACPqH,SAAU,SAACC,GAAD,OAAOV,EAAUc,OAAOJ,EAAEC,OAAO9C,cAG/C,uBACU,SAATzK,GACC,4CACU,IACR,uBACEA,KAAK,SACLyK,MAAO7G,EACP+D,IAAK,EACL0F,SAAU,SAACC,GAAD,OAAOT,EAAUa,OAAOJ,EAAEC,OAAO9C,cAIjD,uBACA,gDACc,IACZ,uBACEA,MAAO5G,EACPwJ,SAAU,SAACC,GAAD,OAAOR,EAAcQ,EAAEC,OAAO9C,aAG5C,4CACU,IACR,uBAAOA,MAAO3G,EAAQuJ,SAAU,SAACC,GAAD,OAAOP,EAAUO,EAAEC,OAAO9C,aAE5D,uBACA,4CACU,IACR,uBAAOA,MAAO1G,EAAQsJ,SAAU,SAACC,GAAD,OAAON,EAAUM,EAAEC,OAAO9C,aAE5D,uBACA,wBAAQzK,KAAK,SAAS2N,QAAS,kBA3JjB,WAChB,IAAMxP,EAAmB,CACvB6B,OACA0D,SAAU,CAAC6I,EAAME,GACjB9I,KAAM,CAACmC,EAAOE,GACdpC,SACAC,aACAC,SACAC,UAEgBtE,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAC9BnC,IAAIoJ,EAAUjO,GA+IqByP,IAAaC,UAAWzB,EAA7D,+BAGA,uBACA,yBACEpM,KAAK,SACLoN,UAAU,sBACVO,QAAS,WACHV,EACFC,EAAiB,MAnJD,WACxB,IACM9D,EADY3J,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAClC+H,EAAiBY,KAAKC,UAAU3E,EAAI4E,WAkJ5BC,IAPN,2BAWiBhB,EAAgB,8CAAe,mDAE7CA,GACD,gCACE,qDACmB,IACjB,0BACExC,MAAOwC,EACPI,SAAU,SAACC,GAAD,OAAOJ,EAAiBI,EAAEC,OAAO9C,aAG/C,wBAAQzK,KAAK,SAAS2N,QA9JJ,WACxB,IACMvE,EADY3J,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAClC,IACE1C,OAAOC,QAAQoL,KAAKI,MAAMjB,GAAiB,KAAKtK,SAC9C,YAAmB,IAAD,mBAAhB/C,EAAgB,KAAX6K,EAAW,KAChBrB,EAAIpG,IAAIpD,EAAK6K,MAGjByC,EAAiB,MACjB,MAAOI,GACPnN,QAAQC,IAAI,iCAAkCkN,KAmJ1C,4CCvMGa,EAAYjC,IAAMC,MAK5B,YAAgE,IAA7DxD,EAA4D,EAA5DA,WAAYC,EAAgD,EAAhDA,UAAWwF,EAAqC,EAArCA,gBAAiBC,EAAoB,EAApBA,cAAoB,EAClCxF,mBAASF,GADyB,mBACzDR,EADyD,KAChDmG,EADgD,OAEpCzF,oBAAUD,GAF0B,mBAEzD2F,EAFyD,KAEjDC,EAFiD,OAGpC3F,mBAAS,IAH2B,mBAGzDH,EAHyD,KAGjD+F,EAHiD,KAuBhE,OACE,sBAAKrB,UAAU,yBAAf,UACE,yCACA,6CACW,IACT,wBACEpN,KAAK,SACL2N,QAAS,WACPa,GAAWD,IAHf,SAMGA,EAAS,KAAO,WAGrB,wBACEA,GACA,qCACE,4CACU,IACR,uBACEvO,KAAK,OACL0O,OAAO,UACPrB,SAAU,SAACC,GAAD,OAzCC,SAACqB,GACtB,IAAMC,EAAOD,GAASA,EAAM,GAC5B,GAAKC,EAGL,GAAIA,EAAKjL,KAAO,MAEdkL,OAAOC,MAAP,qBAA2BF,EAAKjL,WAFlC,CAKA,IAAMrF,EAAS,IAAIC,WACnBD,EAAOE,OAAS,WACe,kBAAlBF,EAAOG,QAChBgQ,EAAUnQ,EAAOG,SAGrBH,EAAOO,cAAc+P,IAyBMG,CAAezB,EAAEC,OAAOoB,aAG7C,0BAGJ,6CACW,IACT,uBACE3O,KAAK,OACLgP,aAAc7G,GAAW,GACzBkF,SAAU,SAACC,GACTgB,EAAWhB,EAAEC,OAAO9C,aAI1B,uBACA,wBACEzK,KAAK,SACL2N,QAAS,WACS,OAAZxF,GACFkG,EAAclG,GAEZS,IAAc2F,GAChBH,IAEExF,GAAaF,GACfuG,YAAgBvG,IAVtB,0B,yBCnEOwG,EAAqB,uCAAG,WAAOxP,GAAP,mBAAAT,EAAA,6DAC7BuO,EAAK9N,EAAOd,MAAM,EAAG,IADQ,SAEZuQ,YAAgBzP,EAAOd,MAAMwQ,MAFjB,cAE7BC,EAF6B,gBAGhBR,OAAOS,OAAOC,OAAOC,UAAU,MAAOH,GAHtB,cAG7BzP,EAH6B,OAGiC6P,EAHjC,yDAIIjC,EAJJ,YAIU5N,IAJV,2CAAH,sDCErB8P,EAAaxD,IAAMC,MAE7B,YAAiB,IAAdzM,EAAa,EAAbA,OAAa,EACyBmJ,qBADzB,mBACV8G,EADU,KACKC,EADL,KAEjB1G,qBAAU,WACR,sBAAC,sBAAAjK,EAAA,kEACC2Q,EADD,SACwBV,EAAsBxP,GAD9C,4EAAD,KAGC,CAACA,IAEJ,IAAMmQ,EAAO,yBAAqBhB,OAAOiB,SAASC,KAAKC,QACrD,cACA,KAGF,OACE,sBAAK5C,UAAU,uBAAf,UACE,gCACE,sBAAM6C,MAAM,uCAAZ,yBACA,uBAAOxF,MAAOoE,OAAOiB,SAASC,KAAMG,UAAQ,OAE9C,8BACE,mBAAGH,KAAMF,EAASI,MAAM,oCAAxB,wBAIF,8BACE,mBAAGF,KAAMJ,EAAepC,OAAO,SAAS4C,IAAI,aAA5C,qCC5BKC,G,cAAUlE,IAAMC,MAAK,kBAChC,qBAAKiB,UAAU,oBAAf,SACE,qBAAKA,UAAU,SAAf,SACE,qD,0BCAOiD,EAAWnE,IAAMC,MAa5B,YAYO,IAXLlE,EAWI,EAXJA,MACAC,EAUI,EAVJA,SACAS,EASI,EATJA,WACA0F,EAQI,EARJA,cACA7F,EAOI,EAPJA,QACA8H,EAMI,EANJA,WACAlI,EAKI,EALJA,SACA/C,EAII,EAJJA,OACAkL,EAGI,EAHJA,MACAlI,EAEI,EAFJA,MACAC,EACI,EADJA,UAEMuC,EAAYD,EAAsBpC,GAClCgI,EAAchI,GAAW,IAAIpG,KAAKoG,GAClCiI,EAA0C,YAAI9H,GAAY,GAC5D+H,EAAQrC,EAAgBsC,OAAOC,cAAc,QAAW,GACxDH,IAEAC,EADEG,YAAQJ,GACFA,EAEAE,OAAOC,cAAc,SAYjC,OACE,sBACExD,UAAU,qBACV9G,MAAO,CAAEwK,QAASjG,EAAY,GAAM,GAFtC,UAIGzC,GAAY/C,EACX,uBACE+H,UAAU,iBACVhM,IAAK,SAAC2P,GACAA,GAAYA,EAASnK,YAAcvB,IAErC0L,EAASnK,UAAYvB,IAGzB2L,UAAQ,EACRC,aAAW,EACXV,MAAOA,IAGT,qBACEW,IAAKjJ,GAASkJ,IACd/D,UAAU,iBACVgE,IAAI,cAGR,qBAAKhE,UAAU,gBAAf,SAAgClF,IAC/BoI,GAAcjC,GACb,wBACErO,KAAK,SACLoN,UAAU,gBACV6C,MAAOtH,GAAc,sBACrBgF,QAxCe,WACrB,GAAIU,EAAe,CAEjB,IAAMgD,EAAOxC,OAAOyC,OAAO,wBACd,OAATD,GACFhD,EAAcgD,KA+Bd,SAMGX,IAGJJ,IAAejC,GACd,qBACEjB,UAAU,gBACV6C,MAAOtH,GAAc,sBAFvB,SAIG+H,IAGJJ,GAAcE,GACb,qBAAKpD,UAAU,mBAAf,SACE,uBAAM6C,MAAOO,EAAYnO,iBAAzB,UACG,UAAGmO,EAAYe,YAAaC,SAAS,EAAG,KAD3C,IAEG,UAAGhB,EAAYiB,cAAeD,SAAS,EAAG,WAI/ClB,GAAclI,GAAY/C,GAC1B,sBAAK+H,UAAU,6BAAf,UACG/E,GAAS,sBAAM4H,MAAM,SAAZ,0BACT3H,GAAa,sBAAM2H,MAAM,aAAZ,mCChGbyB,EAAWxF,IAAMC,MAU5B,YASO,IARLzM,EAQI,EARJA,OACAC,EAOI,EAPJA,OACA+I,EAMI,EANJA,OACAR,EAKI,EALJA,SACAS,EAII,EAJJA,WACA0F,EAGI,EAHJA,cACAsD,EAEI,EAFJA,cACA/I,EACI,EADJA,UAEM1H,EAAY0Q,sBAAYnS,YAAaC,EAAQC,GAAQuB,WADvD,EAE4BuH,EAC9B/I,EACAC,EACA+I,EACAR,EACAS,EACAC,GACA,GACA,GACA,EACA+I,GAVM7I,EAFJ,EAEIA,QAASE,EAFb,EAEaA,WAYjB,OACE,sBAAKoE,UAAU,gBAAf,UACE,qBAAKA,UAAU,gBAAf,SACE,cAAC,EAAD,CACEnF,MAAOa,EACPZ,SAAUA,EACVS,WAAYA,EACZ0F,cAAeA,EACfiC,YAAU,EACVC,OAAK,EACLlI,OAAO,EACPC,WAAW,MAGdU,EAAWI,KAAI,SAACO,GAAD,OACd,qBAAuByD,UAAU,gBAAjC,SACE,cAAC,EAAD,CACEnF,MACoC,kBAA3B/G,EAAUyI,EAAKhK,QAClBgK,EAAK1B,MACL4J,IAEN3J,SAAUyB,EAAK5H,KAAKmG,SACpBS,WAAYgB,EAAK5H,KAAKoG,QACtBK,QAASmB,EAAKnB,QACd8H,YAAU,EACVC,OAAK,EACLlI,OAAO,EACPC,WAAW,KAbLqB,EAAKhK,YAiBfqJ,EAAWzG,QACX,qBAAK6K,UAAU,gBAAf,SACE,cAAC,EAAD,Y,QC3DN0E,EAAgB5F,IAAM6F,MAAK,kBAAM,yDACjCC,GAAa9F,IAAM6F,MAAK,kBAAM,mCAC9BE,GAAU/F,IAAM6F,MAAK,kBAAM,0DAqB3BG,GAAW,SAACxJ,EAAoByJ,EAAsB3E,GAC1D,GAAKA,EAAL,CAD0E,MAE/C2E,EAAU3E,GAA7B9J,EAFkE,EAElEA,SAAUC,EAFwD,EAExDA,KAMlB,OAJED,EAAS,IAAMgF,EAAOhF,SAAS,IAC/BA,EAAS,IAAMgF,EAAOhF,SAAS,IAC/BgF,EAAOhF,SAAS,GAAK,IAAMA,EAAS,GAAKC,EAAK,IAC9C+E,EAAOhF,SAAS,GAAK,IAAMA,EAAS,GAAKC,EAAK,KAI5CyO,GAASlG,IAAMC,MAUnB,YASO,IACDkG,EATJ3S,EAQI,EARJA,OACAC,EAOI,EAPJA,OACAuI,EAMI,EANJA,SACAsF,EAKI,EALJA,GACArP,EAII,EAJJA,KACAmU,EAGI,EAHJA,UACAC,EAEI,EAFJA,YACAC,EACI,EADJA,oBAUA,MAPkB,kBAAdF,EACFD,EAAY,iCACW,mBAAdC,EACTD,EAAY,iCACW,YAAdC,IACTD,EAAY,kCAGZ,sBACEjF,UAAU,oBACV9G,MAAO,CACLiG,KAAK,GAAD,OAAKpO,EAAKuF,SAAS,GAAnB,MACJ+I,IAAI,GAAD,OAAKtO,EAAKuF,SAAS,GAAnB,MACHoC,MAAM,GAAD,OAAK3H,EAAKwF,KAAK,GAAf,MACLqC,OAAO,GAAD,OAAK7H,EAAKwF,KAAK,GAAf,MACN0O,YACAzO,OAAsB,SAAdzF,EAAK6B,KAAkB7B,EAAKyF,YAAS6O,EAC7C5O,WAAY1F,EAAK0F,WACjBC,OAAQ3F,EAAK2F,QAEf4O,YAAa,SAACpF,GACZ,GAAkB,eAAdnP,EAAK6B,OAGTsN,EAAEqF,iBACEJ,GAAa,CACf,IAAMhF,EAASD,EAAEsF,cACXlU,EAAS,CACb4O,EAAEuF,QAAU1U,EAAKuF,SAAS,GAC1B4J,EAAEwF,QAAU3U,EAAKuF,SAAS,IAE5B8O,GAAoB,SAAClF,GACnB,IAAMf,EAAOe,EAAEuF,QAAUnU,EAAO,GAC1B+N,EAAMa,EAAEwF,QAAUpU,EAAO,GAC/B6O,EAAOjH,MAAMiG,KAAb,UAAuBA,EAAvB,MACAgB,EAAOjH,MAAMmG,IAAb,UAAsBA,EAAtB,MACA8F,EAAY,CAAChG,EAAME,SA5B3B,UAiCGtO,EAAK4F,QAAU,wBAAQkM,MAAOzC,EAAI0D,IAAK/S,EAAK4F,OAAQgP,YAAY,MAClD,SAAd5U,EAAK6B,MACJ,cAAC,WAAD,CAAUgT,SAAU,cAACC,EAAA,EAAD,IAApB,SACE,cAACnB,EAAD,CACEpS,OAAQA,EACRC,OAAQA,EACRuI,SAAUA,EACVgL,SAAU1F,MAID,UAAdrP,EAAK6B,MACJ,cAAC,WAAD,CAAUgT,SAAU,cAACC,EAAA,EAAD,IAApB,SACE,cAACjB,GAAD,CACEtS,OAAQA,EACRC,OAAQA,EACRuI,SAAUA,EACVgL,SAAU1F,MAID,YAAdrP,EAAK6B,MACJ,cAAC,WAAD,CAAUgT,SAAU,cAACC,EAAA,EAAD,IAApB,SACE,cAAChB,GAAD,CAASvS,OAAQA,EAAQC,OAAQA,EAAQuT,SAAU1F,YAQzD2F,GAASjH,IAAMC,MAcnB,YAaO,IAZLjE,EAYI,EAZJA,SACAS,EAWI,EAXJA,WACA0F,EAUI,EAVJA,cACApG,EASI,EATJA,MACAO,EAQI,EARJA,QACA9E,EAOI,EAPJA,SACA6O,EAMI,EANJA,YACAC,EAKI,EALJA,oBACAnN,EAII,EAJJA,OACA+C,EAGI,EAHJA,SACAmI,EAEI,EAFJA,MACAlI,EACI,EADJA,MAEMwC,EAAYD,EAAsBpC,GACxC,OACE,sBACE4E,UAAU,oBACV9G,MAAO,CACLiG,KAAK,GAAD,OAAK7I,EAAS,GAAd,MACJ+I,IAAI,GAAD,OAAK/I,EAAS,GAAd,OAELgP,YAAa,SAACpF,GAEZ,GADAA,EAAEqF,iBACEJ,EAAa,CACf,IAAMhF,EAASD,EAAEsF,cACXlU,EAAS,CAAC4O,EAAEuF,QAAUnP,EAAS,GAAI4J,EAAEwF,QAAUpP,EAAS,IAC9D8O,GAAoB,SAAClF,GACnB,IAAMf,EAAOe,EAAEuF,QAAUnU,EAAO,GAC1B+N,EAAMa,EAAEwF,QAAUpU,EAAO,GAC/B6O,EAAOjH,MAAMiG,KAAb,UAAuBA,EAAvB,MACAgB,EAAOjH,MAAMmG,IAAb,UAAsBA,EAAtB,MACA8F,EAAY,CAAChG,EAAME,SAhB3B,UAqBG9D,GACC,qBACEyE,UAAU,4BACV9G,MAAO,CAAEwK,QAASjG,EAAY,GAAM,GAFtC,SAIGlC,IAGL,cAAC,EAAD,CACEV,MAAOA,EACPC,SAAUA,EACVS,WAAYA,EACZ0F,cAAeA,EACf7F,QAASA,EACTJ,SAAUA,EACV/C,OAAQA,EACRkL,QAASA,EACTlI,QAASA,EACTC,UAAWF,UAORgL,GAAalH,IAAMC,MAY9B,YAWO,IAVLzM,EAUI,EAVJA,OACAC,EASI,EATJA,OACA+I,EAQI,EARJA,OACAR,EAOI,EAPJA,SACAS,EAMI,EANJA,WACA0F,EAKI,EALJA,cACAsD,EAII,EAJJA,cACA0B,EAGI,EAHJA,cACAjF,EAEI,EAFJA,gBACAxF,EACI,EADJA,UACI,EAC4BH,EAC9B/I,EACAC,EACA+I,EACAR,EACAS,EACAC,GACA,GACA,GACA,EACA+I,GAVM7I,EADJ,EACIA,QAASE,EADb,EACaA,WADb,EZ5JqB,SAACtJ,EAAgBC,GAAoB,IAnFtCiD,EAmFqC,EAC7BiG,mBAAoB,IADS,mBACxDyK,EADwD,KAC7CC,EAD6C,OAE/B1K,mBAAqB,CACnDnF,UAtFwBd,EAsFKjD,EAtF6B,CAC5D6T,SAAS5Q,EAAIhE,MAAM,EAAG,GAAI,IAAM,EAAI,GACpC4U,SAAS5Q,EAAIhE,MAAM,EAAG,GAAI,IAAM,EAAI,OAiF2B,mBAExD6U,EAFwD,KAE9CC,EAF8C,KAM/DxK,qBAAU,WACR,IAAMC,EAAY1J,YAAaC,EAAQC,GACjCyJ,EAAMD,EAAUhI,KAAKkI,OAAO,mBAC5BC,EAAW,WACfiK,GAAa,SAAChK,GACZ,IAAMC,EAAM,eAAQD,GAChBE,GAAU,EAmBd,OAlBAL,EAAIzG,SAAQ,SAACxE,EAAMyE,GAxED,IAAC3D,EAAe0U,EAyE5B/Q,IAAQjD,GACPwJ,EAAUjI,UAAU0B,IAzFd,SAAC9E,GACpB,IACE,IAAM8V,EAAM9V,EACZ,MAC6B,kBAApB8V,EAAIlQ,SAAS,IACO,kBAApBkQ,EAAIlQ,SAAS,GAKtB,MAAO4J,GACP,OAAO,GA+EIuG,CAAa1V,KACbqL,EAAO5G,IA5EK3D,EA+Ead,EA/EEwV,EA+EInK,EAAO5G,IA9EnD3D,EAAEyE,SAAS,KAAOiQ,EAAEjQ,SAAS,IAAMzE,EAAEyE,SAAS,KAAOiQ,EAAEjQ,SAAS,MA+EtD8F,EAAO5G,GAAOzE,EACdsL,GAAU,KAJVD,EAAO5G,GAAOzE,EACdsL,GAAU,OAMdhH,OAAOsC,KAAKyE,GAAQ7G,SAAQ,SAACC,GACtBuG,EAAUjI,UAAU0B,YAChB4G,EAAO5G,GACd6G,GAAU,MAGVA,EACKD,EAEFD,MAGXH,EAAIY,QAAQV,GACZ,IAAMW,EAAQC,oBAAUf,EAAUjI,UAAWoI,GAE7C,OADAA,IACO,WACLW,IACAb,EAAIe,UAAUb,MAEf,CAAC5J,EAAQC,IAEZ,IAAMmU,EAAkBC,mBACxB7K,qBAAU,WACHuK,IACDK,EAAgBE,QAClBF,EAAgBE,QAAUP,GAE1BK,EAAgBE,QAAUP,EAC1BrQ,YAAW,WACS3D,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAO,mBAC9BrG,IAAIrD,EAAQmU,EAAgBE,SAChCF,EAAgBE,aAAUvB,IACzB,SAEJ,CAAC/S,EAAQC,EAAQ8T,IA5D2C,MA8D7B5K,mBAAoB,IA9DS,mBA8DxDsJ,EA9DwD,KA8D7C8B,EA9D6C,KAgE/D/K,qBAAU,WACR,IACME,EADY3J,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAC5BmE,EAAW,WACf2K,GAAa,SAAC1K,GACZ,IAAM2K,EAAkB,GASxB,OARA9K,EAAIzG,SAAQ,SAACxE,EAAMqP,GA3FD,IAACvO,EAAe0U,GAzBrB,SAAC7V,GACpB,IACE,IAAM8V,EAAM9V,EACZ,SACE,CAAC,aAAc,UAAW,OAAQ,QAAS,WAAWoC,SACpD0T,EAAI5T,OAEqB,kBAApB4T,EAAIlQ,SAAS,IACO,kBAApBkQ,EAAIlQ,SAAS,IACG,kBAAhBkQ,EAAIjQ,KAAK,IACO,kBAAhBiQ,EAAIjQ,KAAK,IACO,qBAAfiQ,EAAIhQ,QAAgD,kBAAfgQ,EAAIhQ,QACtB,qBAAnBgQ,EAAI/P,YACgB,kBAAnB+P,EAAI/P,YACU,qBAAf+P,EAAI9P,QAAgD,kBAAf8P,EAAI9P,QAC1B,qBAAf8P,EAAI7P,QAAgD,kBAAf6P,EAAI7P,QAKnD,MAAOuJ,GACP,OAAO,IAgGI6G,CAAahW,KACdoL,EAAKiE,KA7FuBmG,EA6FYxV,GA7F3Bc,EA6FiBsK,EAAKiE,IA5F7CxN,OAAS2T,EAAE3T,MACbf,EAAEyE,SAAS,KAAOiQ,EAAEjQ,SAAS,IAC7BzE,EAAEyE,SAAS,KAAOiQ,EAAEjQ,SAAS,IAC7BzE,EAAE0E,KAAK,KAAOgQ,EAAEhQ,KAAK,IACrB1E,EAAE0E,KAAK,KAAOgQ,EAAEhQ,KAAK,IACrB1E,EAAE2E,SAAW+P,EAAE/P,QACf3E,EAAE4E,aAAe8P,EAAE9P,YACnB5E,EAAE6E,SAAW6P,EAAE7P,QACf7E,EAAE8E,SAAW4P,EAAE5P,QAqFLmQ,EAAK1G,GAAMjE,EAAKiE,GAEhB0G,EAAK1G,GAAMrP,MAGR+V,MAGX9K,EAAIY,QAAQV,GACZA,IACA,IAAMc,EAAQhH,YAAW,WACvB,IAAMgR,EAAaC,eAA0B,GACvCC,EAASpP,EAAYkP,GACtBE,IACDlL,EAAIzF,KAAO,GACflB,OAAOC,QAAQ4R,GAAQ3R,SAAQ,YAAmB,IAAD,mBAAhB/C,EAAgB,KAAX6K,EAAW,KAC/CrB,EAAIpG,IAAIpD,EAAK6K,SAEd,KACH,OAAO,WACLE,aAAaP,GACbhB,EAAIe,UAAUb,MAEf,CAAC5J,EAAQC,IAEZ,IAAM4U,EAAWR,iBAAyC,IACpDS,EAAeC,uBACnB,SAACjH,EAAYrP,GACXwM,aAAa4J,EAASP,QAAQxG,IAC9B+G,EAASP,QAAQxG,GAAMpK,YAAW,WACd3D,YAAaC,EAAQC,GACjBwB,KAAKkI,OAAOlE,GAC9BnC,IAAIwK,EAAIrP,KACX,OAEL,CAACuB,EAAQC,IAGX,MAAO,CACL2T,YACAG,WACAC,cACAvB,YACAqC,gBY2DIE,CAAchV,EAAQC,GALxB2T,EAdE,EAcFA,UACAG,EAfE,EAeFA,SACAC,EAhBE,EAgBFA,YACAvB,EAjBE,EAiBFA,UACAqC,EAlBE,EAkBFA,aAGIG,EAAiBZ,mBACjBvB,EAAsBiC,uBAAY,SAACG,GACvCD,EAAeX,QAAUY,IACxB,IAEGC,EAtPuB,SAACnM,EAAoByJ,GAcpD,OAbqB1P,OAAOsC,KAAKoN,GAAW2C,MAC1C,SAAC7V,EAAG0U,GAAJ,eAAU,UAACxB,EAAUwB,GAAG/P,cAAd,QAAwB,IAAxB,UAA8BuO,EAAUlT,GAAG2E,cAA3C,QAAqD,MAEnCmR,MAAK,SAACvH,GAAQ,IAAD,EACR2E,EAAU3E,GAAnCxN,EADiC,EACjCA,KAAM0D,EAD2B,EAC3BA,SAAUC,EADiB,EACjBA,KACxB,MACW,YAAT3D,GACA0D,EAAS,IAAMgF,EAAOhF,SAAS,GAAK,IACpCA,EAAS,IAAMgF,EAAOhF,SAAS,GAAK,IACpCgF,EAAOhF,SAAS,IAAMA,EAAS,GAAKC,EAAK,IACzC+E,EAAOhF,SAAS,IAAMA,EAAS,GAAKC,EAAK,MA2ObqR,CAAyBvB,EAAUtB,GAC3D8C,EAAqB/C,GACzBuB,EACAtB,EACA0C,GA9BE,ER9NqB,SAC3BnV,EACAC,EACAuV,EACAC,EACA9M,EACAsJ,EACA0B,EACA+B,GAEA,IAAMC,EAAS,UAAMD,GAAiB,OAAvB,SACTE,EAAS,UAAMF,GAAiB,OAAvB,SAFZ,EAGiCvM,mBAA6B,MAH9D,mBAGI0M,EAHJ,KAGgBC,EAHhB,OAIuC3M,mBAEvC,IANA,mBAII4M,EAJJ,KAImBC,EAJnB,KAQGC,EAAY5B,kBAAO,GACzB7K,qBAAU,WAIR,OAHgB,WACdyM,EAAU3B,SAAU,KAGrB,IAEH9K,qBAAU,WACHgM,GAAiBC,GAEpBO,EAAiB,MAElB,CAACR,EAAcC,IAElB,IAAMS,EAAU,SAAC,GAA8C,IAAD,qBAA5ChT,EAA4C,KAAvC/B,EAAuC,KAC5D,GAAyB,UAArBA,EAAMgV,cACV,UAAIJ,EAAc7S,UAAlB,aAAI,EAAoBoJ,YAAY9L,SAASW,IAA7C,CACA,IAAM8K,EAAgB,SAACmK,GACjBH,EAAU3B,SACZ0B,GAAiB,SAACnM,GAAU,IACXwM,EAAuBxM,EAA7B3G,GAAoBoT,EADJ,YACazM,EADb,CAChB3G,GADgB,UAEzB,OAAImT,IAAcD,EACTE,EAEFzM,MAIbmM,GAAiB,SAACnM,GAChB,IAAMlE,EAASkE,EAAK3G,GACdgJ,EAAYF,EAAiB7K,EAAOwE,EAAQsG,GAClD,OAAItG,IAAWuG,EACNrC,EAEF,2BAAKA,GAAZ,kBAAmB3G,EAAMgJ,SAIvBtK,EAAWsQ,sBAAYnS,YAAaC,EAAQC,GAAQ2B,UAwG1D,OAvGAmB,OAAOC,QAAQpB,EAAS+T,IAAc,IAAI1S,QAAQiT,GAClDnT,OAAOC,QAAQpB,EAASgU,IAAc,IAAI3S,QAAQiT,GAElD1M,qBAAU,WACR,IAAMC,EAAY1J,YAAaC,EAAQC,GACnCsW,EAAuC,KAgC3C,OA/BIf,GACF,sBAAC,0CAAAjW,EAAA,sEAIWiX,YAAmBvE,GAJ9B,gBAEWwE,EAFX,EAEG9Q,OACS+Q,EAHZ,EAGGrV,QAHH,EAKsBoV,EAAY/O,iBALlC,mBAKQiP,EALR,KAMClN,EAAUpJ,aAAasV,GACvBlM,EAAUvI,SAASyU,EAAWgB,GACxB1K,EAAgB,SAACmK,GACjBH,EAAU3B,SACZwB,GAAc,SAACjM,GAAD,OAAWA,IAASuM,EAAI,KAAOvM,MAGjDiM,GAAc,SAACjM,GAAD,OACZmC,EAAiB2K,EAAY9M,EAAMoC,MAE/B5K,EAAU,WACdoI,EAAU1I,gBAAgB4U,GAC1BlM,EAAUrI,YAAYuU,GACtBe,IAEAC,EAAWvK,cAAc,IAAIwK,MAAM,YAErB,IAAZL,EACFlV,IAEAkV,EAAUlV,EA1Bb,2CAAD,GA8BK,WACDkV,GAASA,IACbA,GAAU,KAEX,CAACvW,EAAQC,EAAQuV,EAAcvD,EAAe0D,IAEjDnM,qBAAU,WACR,IAAMC,EAAY1J,YAAaC,EAAQC,GACnCsW,EAAuC,KAgC3C,OA/BId,GACF,sBAAC,0CAAAlW,EAAA,sEAIWiM,EAAemI,GAJ1B,gBAEWkD,EAFX,EAEGlR,OACSmR,EAHZ,EAGGzV,QAHH,EAKsBwV,EAAYnL,iBALlC,mBAKQqL,EALR,KAMCtN,EAAUpJ,aAAauV,GACvBnM,EAAUvI,SAAS0U,EAAWmB,GACxB9K,EAAgB,SAACmK,GACjBH,EAAU3B,SACZwB,GAAc,SAACjM,GAAD,OAAWA,IAASuM,EAAI,KAAOvM,MAGjDiM,GAAc,SAACjM,GAAD,OACZmC,EAAiB+K,EAAYlN,EAAMoC,MAE/B5K,EAAU,WACdoI,EAAU1I,gBAAgB6U,GAC1BnM,EAAUrI,YAAYwU,GACtBkB,IAEAC,EAAW3K,cAAc,IAAIwK,MAAM,YAErB,IAAZL,EACFlV,IAEAkV,EAAUlV,EA1Bb,2CAAD,GA8BK,WACDkV,GAASA,IACbA,GAAU,KAEX,CAACvW,EAAQC,EAAQwV,EAAc9B,EAAeiC,IAEjDpM,qBAAU,WACR,GAAIqM,EAAY,CACdA,EAAWnK,iBAAiBzI,SAAQ,SAAC9B,GAChBA,EACR6V,QAAUrO,KAEvB,IAAMsO,EAAa,SAACC,GAAkC,IAC5C/V,EAAU+V,EAAV/V,MACW,UAAfA,EAAMgW,OACRhW,EAAM6V,QAAUrO,IAIpB,OADAkN,EAAWzS,iBAAiB,WAAY6T,GACjC,WACLpB,EAAWuB,oBAAoB,WAAYH,OAI9C,CAACpB,EAAYlN,IAET,CAAEkN,aAAYE,iBQ+FmBsB,CACpCrX,EACAC,IACEkV,IACAA,IACAI,EACFtD,EACA0B,EAPiD,6BAQ3BwB,EAR2B,MAA3CU,EAjCJ,EAiCIA,WAAYE,EAjChB,EAiCgBA,cAjChB,EA4C8B5M,mBAEhC,MA9CE,mBA4CGmO,EA5CH,KA4CcC,EA5Cd,KAgDJ,OACE,sBAAK7J,UAAU,uBAAf,UACE,sBACEA,UAAU,kBACVwH,YAAa,SAACtH,GACRqH,EAAeX,SACjBW,EAAeX,QAAQ1G,IAG3B4J,UAAW,WACT1E,KARJ,UAWG/P,OAAOC,QAAQyP,GAAW/I,KAAI,mCAAEgD,EAAF,KAAY+K,EAAZ,YAC7B,cAAC/E,GAAD,CAEE1S,OAAQA,EACRC,OAAQA,EACRuI,SAAUA,EACVsF,GAAIpB,EACJjO,KAAMgZ,EACN7E,UACGlG,IAAayI,IACXI,EAAqB,gBAAkB,oBACrB,YAApBkC,EAAWnX,KAAqB,eAAYyS,GAE/CF,YAAa,SAAC7O,GAAD,OACX8Q,EAAapI,EAAD,YAAC,eAAe+K,GAAhB,IAA4BzT,eAE1C8O,oBAAqBA,GAdhBpG,MAiBR3J,OAAOC,QAAQ4Q,GAAWlK,KAAI,YAAwB,IAAD,mBAArBxG,EAAqB,KAAhBwU,EAAgB,KACpD,GAAIxU,IAAQjD,EACV,OAAO,KAET,IAAM0X,EAAYrO,EAAW+L,MAAK,SAAC5W,GAAD,OAAUA,EAAKwB,SAAWiD,KAC5D,OAAKyU,EAIH,cAAClE,GAAD,CAEEjL,SAAUmP,EAAUtV,KAAKmG,SACzBS,WAAY0O,EAAUtV,KAAKoG,QAC3BF,MAAOoP,EAAUpP,MACjBO,QAAS6O,EAAU7O,QACnB9E,SAAU0T,EAAW1T,SACrB8O,oBAAqBA,EACrBnN,OAAQoQ,EAAc7S,GACtBwF,WAAYyM,EACZxM,MAAO6J,GAASkF,EAAYjF,EAAW0C,IATlCjS,GAJA,QAiBX,cAACuQ,GAAD,CACEjL,SAAUA,EACVS,WAAYA,EACZ0F,cAAeA,EACfpG,MAAOa,EACPpF,SAAU+P,EAAS/P,SACnB6O,YAAa,SAAC7O,GAAD,OACXgQ,GAAY,SAACnK,GAAD,mBAAC,eAAeA,GAAhB,IAAsB7F,iBAEpC8O,oBAAqBA,EACrBnN,OAAQkQ,QAAc9C,EACtBrK,WAAYyM,EACZtE,OAAK,EACLlI,MAAO4M,OAGX,qBAAK7H,UAAU,sBAAf,SACE,cAAC,EAAD,CACE1N,OAAQA,EACRC,OAAQA,EACR+I,OAAQA,EACRR,SAAUA,EACVS,WAAYA,EACZ0F,cAAeA,EACfsD,cAAeA,EACf/I,UAAWA,MAGf,sBAAKwE,UAAU,qBAAf,UACE,gCACE,wBACEpN,KAAK,SACL2N,QAAS,kBACPsJ,EAA2B,YAAdD,EAA0B,KAAO,YAHlD,SAMiB,YAAdA,EAA0B,gBAAkB,iBAEhC,YAAdA,GACC,qBAAK5J,UAAU,qBAAf,SACE,cAACe,EAAD,CACExF,WAAYA,EACZC,UAAWA,EACXwF,gBAAiBA,EACjBC,cAAeA,SAKvB,gCACE,wBACErO,KAAK,SACL2N,QAAS,kBACPsJ,EACgB,kBAAdD,EAAgC,KAAO,kBAJ7C,SAQiB,kBAAdA,EACG,sBACA,uBAES,kBAAdA,GACC,qBAAK5J,UAAU,2BAAf,SACE,cAAC,EAAD,CAAc1N,OAAQA,EAAQC,OAAQA,SAI5C,gCACE,wBACEK,KAAK,SACL2N,QAAS,kBACPsJ,EAA2B,gBAAdD,EAA8B,KAAO,gBAHtD,SAMiB,gBAAdA,EACG,oBACA,qBAES,gBAAdA,GACC,qBAAK5J,UAAU,yBAAf,SACE,cAAC,EAAD,CAAY1N,OAAQA,kBCtavB4X,GAAapL,IAAMC,MAAK,WAAO,IAAD,EACNyF,sBAAY2F,KAAvC7X,EADiC,EACjCA,OAAQC,EADyB,EACzBA,OAAQ6X,EADiB,EACjBA,OADiB,EAEL3O,mBAAS,IAFJ,mBAElCF,EAFkC,KAEtB0F,EAFsB,KAOzC,OAJAnF,qBAAU,WACRuO,YAAe/X,KACd,CAACA,IAGF,qBAAK0N,UAAU,uBAAf,SACE,cAAC,GAAD,CACE1N,OAAQA,EACRC,OAAQA,EACR+I,OAAQ8O,EAAO9O,OACfR,SAAUsP,EAAOtP,SACjBS,WAAYA,EACZ0F,cAAeA,EACfzF,WAAY4O,EAAOhS,UACnBmM,cAAe6F,EAAO7F,cACtB0B,cAAemE,EAAOnE,cACtBjF,gBAAiBsJ,WAMVJ,c,uICjCFK,EAAc,uCAAG,WAAO5Q,GAAP,yBAAA9H,EAAA,6DACtB+H,EAAcD,EAChB,CACEd,MAAO,CAAEc,aAEX,CAAEd,OAAO,GALe,SAMPgB,UAAUC,aAAaC,aAAaH,GAN7B,cAMtB3B,EANsB,SAOZA,EAAO+B,iBAPK,mBAOrBvG,EAPqB,KAQtBE,EAAU,WACdF,EAAMiH,QAToB,kBAWrB,CACLzC,SACAtE,YAb0B,2CAAH,sDAiBdmV,EAAkB,uCAAG,WAAOnP,GAAP,yBAAA9H,EAAA,6DAC1B+H,EAAc,CAClBf,MAAO,CACLc,WACA6Q,UAAW,CAAEjQ,IAAK,GAClB7B,MAAO,CAAE+R,MAAO,IAChB7R,OAAQ,CAAE6R,MAAO,MANW,SASX5Q,UAAUC,aAAaC,aAAaH,GATzB,cAS1B3B,EAT0B,SAUhBA,EAAO+B,iBAVS,mBAUzBvG,EAVyB,KAW1BE,EAAU,WACdF,EAAMiH,QAZwB,kBAczB,CACLzC,SACAtE,YAhB8B,2CAAH,uD,iCChB/B,iGAQa+W,EAAcC,IAOdlH,EAAU,SAACiF,GAMtB,QALoCkC,YAClClC,EACA,QACC3X,K","file":"static/js/9.35f43ecb.chunk.js","sourcesContent":["export const isObject = (x: unknown): x is Record<string, unknown> =>\n  typeof x === \"object\" && x !== null;\n\nexport const hasStringProp = <\n  Obj extends Record<string, unknown>,\n  Prop extends string\n>(\n  x: Obj,\n  prop: Prop\n): x is Obj & Record<Prop, string> =>\n  typeof (x as Record<Prop, unknown>)[prop] === \"string\";\n\nexport const hasObjectProp = <\n  Obj extends Record<string, unknown>,\n  Prop extends string\n>(\n  x: Obj,\n  prop: Prop\n): x is Obj & Record<Prop, Record<string, unknown>> =>\n  isObject((x as Record<Prop, unknown>)[prop]);\n\nexport type ReturnPromiseType<\n  F extends (...args: any) => any\n> = ReturnType<F> extends Promise<infer T> ? T : never;\n","export const encodeBase64Sync = (data: Uint8Array) => {\n  const base64 = btoa(String.fromCharCode(...data));\n  return base64;\n};\n\nexport const decodeBase64Sync = (base64: string) => {\n  const binaryString = atob(base64);\n  const data = new Uint8Array(\n    ([].map.call(binaryString, (c: string) =>\n      c.charCodeAt(0)\n    ) as unknown) as ArrayBufferLike\n  );\n  return data;\n};\n\nexport const encodeBase64Async = (data: Uint8Array) =>\n  new Promise((resolve) => {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const result = reader.result as string;\n      const offset = result.indexOf(\",\") + 1;\n      resolve(result.slice(offset));\n    };\n    reader.readAsDataURL(new Blob([data]));\n  });\n\nexport const decodeBase64Async = async (base64: string) => {\n  const response = await fetch(\n    `data:application/octet-binary;base64,${base64}`\n  );\n  const buf = await response.arrayBuffer();\n  return new Uint8Array(buf);\n};\n","import { proxy, snapshot, ref } from \"valtio\";\nimport * as Y from \"yjs\";\n\nimport { PeerInfo, createRoom, NetworkStatus } from \"../network/room\";\nimport { encodeBase64Async, decodeBase64Async } from \"../utils/base64\";\n\ntype RoomState = {\n  networkStatusList: NetworkStatus[];\n  // userIdMap: number is peerIndex\n  userIdMap: { [userId: string]: number | \"closed\" };\n  ydoc: Y.Doc;\n  acceptingMediaTypes: string[];\n  trackMap: {\n    [mediaType: string]: {\n      [userId: string]: MediaStreamTrack;\n    };\n  };\n  addMediaType: (type: string) => Promise<void>;\n  removeMediaType: (type: string) => Promise<void>;\n  addTrack: (type: string, track: MediaStreamTrack) => Promise<void>;\n  removeTrack: (type: string) => Promise<void>;\n  dispose: () => Promise<void>;\n};\n\nconst createRoomState = (roomId: string, userId: string) => {\n  const addMediaType = async (type: string) => {\n    if (state.acceptingMediaTypes.includes(type)) {\n      console.log(\"media type already added\", type);\n      return;\n    }\n    state.acceptingMediaTypes.push(type);\n    const room = await roomPromise;\n    room.acceptMediaTypes(snapshot(state.acceptingMediaTypes));\n  };\n  const removeMediaType = async (type: string) => {\n    const index = state.acceptingMediaTypes.indexOf(type);\n    if (index === -1) {\n      console.log(\"media type already added\", type);\n      return;\n    }\n    state.acceptingMediaTypes.splice(index, 1);\n    const room = await roomPromise;\n    room.acceptMediaTypes(snapshot(state.acceptingMediaTypes));\n  };\n  const addTrack = async (type: string, track: MediaStreamTrack) => {\n    const room = await roomPromise;\n    room.addTrack(type, track);\n  };\n  const removeTrack = async (type: string) => {\n    const room = await roomPromise;\n    room.removeTrack(type);\n  };\n  const dispose = async () => {\n    const room = await roomPromise;\n    room.dispose();\n  };\n  const state = proxy<RoomState>({\n    networkStatusList: [],\n    userIdMap: {},\n    ydoc: ref(new Y.Doc()),\n    acceptingMediaTypes: [],\n    trackMap: {},\n    addMediaType,\n    removeMediaType,\n    addTrack,\n    removeTrack,\n    dispose,\n  });\n  const updateNetworkStatus = (status: NetworkStatus) => {\n    console.log(new Date().toLocaleString(), \"[network status]\", status);\n    state.networkStatusList.unshift(status);\n    if (state.networkStatusList.length > 10) {\n      state.networkStatusList.pop();\n    }\n    if (status?.type === \"CONNECTION_CLOSED\") {\n      Object.entries(state.userIdMap).forEach(([uid, idx]) => {\n        if (idx === status.peerIndex) {\n          state.userIdMap[uid] = \"closed\";\n          // FIXME somehow this might be causing fatal behavior\n          // delete state.userIdMap[uid];\n        }\n      });\n    }\n  };\n  const notifyNewPeer = async (peerIndex: number) => {\n    const update = Y.encodeStateAsUpdate(state.ydoc);\n    const base64 = await encodeBase64Async(update);\n    const data = { ydocUpdate: base64 };\n    roomPromise.then((room) => {\n      // XXX this does not scale\n      room.sendData(data, peerIndex);\n    });\n  };\n  const receiveData = async (data: any, info: PeerInfo) => {\n    state.userIdMap[info.userId] = info.peerIndex;\n    if (data?.ydocUpdate) {\n      const update = await decodeBase64Async(data.ydocUpdate);\n      Y.applyUpdate(state.ydoc, update);\n    }\n  };\n  state.ydoc.on(\"update\", async (update: Uint8Array) => {\n    const base64 = await encodeBase64Async(update);\n    roomPromise.then((room) => {\n      room.broadcastData({ ydocUpdate: base64 });\n    });\n  });\n  const receiveTrack = (\n    mediaType: string,\n    track: MediaStreamTrack,\n    info: PeerInfo\n  ) => {\n    if (!state.trackMap[mediaType]) {\n      state.trackMap[mediaType] = {};\n    }\n    track.addEventListener(\"ended\", () => {\n      if (state.trackMap[mediaType][info.userId] === track) {\n        delete state.trackMap[mediaType][info.userId];\n      }\n    });\n    state.trackMap[mediaType][info.userId] = ref(track);\n  };\n  const roomPromise = createRoom(\n    roomId,\n    userId,\n    updateNetworkStatus,\n    notifyNewPeer,\n    receiveData,\n    receiveTrack\n  );\n  return state;\n};\n\nconst roomMap = new Map<string, RoomState>();\n\nexport const getRoomState = (roomId: string, userId: string) => {\n  const key = `${roomId}:${userId}`;\n  if (!roomMap.has(key)) {\n    const state = createRoomState(roomId, userId);\n    roomMap.set(key, state);\n  }\n  return roomMap.get(key) as RoomState;\n};\n\nexport const disposeRoomState = (roomId: string, userId: string) => {\n  const key = `${roomId}:${userId}`;\n  const state = roomMap.get(key);\n  if (state) {\n    roomMap.delete(key);\n    state.dispose();\n  }\n};\n","export const sleep = (ms: number) =>\n  new Promise((resolve) => setTimeout(resolve, ms));\n","import { RegionData } from \"../hooks/useGatherArea\";\n\nconst createMeeting = (\n  i: number,\n  x: number,\n  y: number,\n  w: number,\n  h: number\n) => ({\n  [`meeting${i}`]: {\n    type: \"meeting\",\n    position: [x, y],\n    size: [w, h],\n    zIndex: 0,\n    background: \"\",\n    border: \"\",\n    iframe: \"\",\n  },\n});\n\nconst createGoBoard = (i: number, x: number, y: number) => ({\n  [`gomeeting${i}`]: {\n    type: \"meeting\",\n    position: [x, y],\n    size: [250, 150],\n    zIndex: 0,\n    background: \"\",\n    border: \"\",\n    iframe: \"\",\n  },\n  [`gobard${i}`]: {\n    type: \"goboard\",\n    position: [x, y],\n    size: [250, 150],\n    zIndex: 0,\n    background: \"rgba(140, 140, 140, 0.2)\",\n    border: \"\",\n    iframe: \"\",\n  },\n});\n\nconst intro: Record<string, RegionData> = {\n  background: {\n    type: \"background\",\n    position: [36, 36],\n    size: [800, 500],\n    zIndex: -100,\n    background:\n      \"url(data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDY2Ny4yOTIyOTgzMDU3OTI3IDQxOC4xNDczNjEzODYyNzcyIiB3aWR0aD0iMTMzNC41ODQ1OTY2MTE1ODUzIiBoZWlnaHQ9IjgzNi4yOTQ3MjI3NzI1NTQ1Ij4KICA8IS0tIHN2Zy1zb3VyY2U6ZXhjYWxpZHJhdyAtLT4KICAKICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgQGZvbnQtZmFjZSB7CiAgICAgICAgZm9udC1mYW1pbHk6ICJWaXJnaWwiOwogICAgICAgIHNyYzogdXJsKCJodHRwczovL2V4Y2FsaWRyYXcuY29tL1ZpcmdpbC53b2ZmMiIpOwogICAgICB9CiAgICAgIEBmb250LWZhY2UgewogICAgICAgIGZvbnQtZmFtaWx5OiAiQ2FzY2FkaWEiOwogICAgICAgIHNyYzogdXJsKCJodHRwczovL2V4Y2FsaWRyYXcuY29tL0Nhc2NhZGlhLndvZmYyIik7CiAgICAgIH0KICAgIDwvc3R5bGU+CiAgPC9kZWZzPgogIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSI2NjcuMjkyMjk4MzA1NzkyNyIgaGVpZ2h0PSI0MTguMTQ3MzYxMzg2Mjc3MiIgZmlsbD0iI2ZmZmZmZiI+PC9yZWN0PjxnPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUzLjQ5Nzc3MzUzMDI3OTc0NCAyMDMuNDAxNzY0NDE1NzM2MjQpIHJvdGF0ZSgwIC0xOS42MDg3MTQwNDM1Njc1NDUgLTI1LjY3MDMzNTAxNDg0OTk2OCkiPjxwYXRoIGQ9Ik0wLjA0MDc4OTI4NTY3NDY5MTIgMC45Mzk2MDg4MDMwMTg5Mjc0IEMtNi4zODU5NzU3NzkzNTIyODkgLTcuODM1OTk0ODM4NjU1MDIwNCwgLTMxLjkzNzUxNjQ0NjY5ODIxIC00My40NTIxNDcxOTExNjcsIC0zOC42NTQ4NTA0MzU2NzUzODUgLTUyLjI4MDI3ODgzMjcxODg4IE0tMS4zOTY5MzUwNjg2ODU1NjE1IDAuMzg3Mjk5NDc5MjY0NzY2MTYgQy03LjkxNjAyNzI0NzQ2MDEzNjUgLTguMjcwNDExODcyNjUxNDUsIC0zMy4xNzk2MDIyNzkxNDg3NDYgLTQyLjUxNzM2NTQxMTEyODk3LCAtMzkuMjU4MjE3MzcyODA5Nzk2IC01MS4wNjU3MDEyNDgwNjEwNiIgc3Ryb2tlPSJibGFjayIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIj48L3BhdGg+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUzLjQ5Nzc3MzUzMDI3OTc0NCAyMDMuNDAxNzY0NDE1NzM2MjQpIHJvdGF0ZSgwIC0xOS42MDg3MTQwNDM1Njc1NDUgLTI1LjY3MDMzNTAxNDg0OTk2OCkiPjxwYXRoIGQ9Ik0tMTIuODE5NTU5MjAxNTg1NTczIC0zMy4xOTc5NDQ4NTk4MDkxMyBDLTIyLjcyOTA5MTEzNzk5NDczIC00MC43NzA0MDI4NDQ1NjY0NiwgLTI5LjU3NzAxMzE2ODExNjA3IC00NC40MzUyOTM5NjAyODc3OSwgLTQxLjE3OTY5NDcyNjAxMDExIC01MC42OTkwMTc1ODA1MzU0MSBNLTE0LjgzMjg2MTc1NzgyNDY0MiAtMzMuMzI1NjM3MDc1ODg1MDggQy0yMy4wOTQ1OTE4MzE5MjYwOTUgLTM5LjQ0ODUwODEzMzYwMzIzLCAtMjkuNDgyNTU4MTQwMzcxMTc1IC00NS4xNjMzNTk5OTQ5MDM5MywgLTM4LjU0OTkxMTY1MzUwMTI0IC01MC40NDAzMjQ1MDQ3OTY1NjQiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1My40OTc3NzM1MzAyNzk3NDQgMjAzLjQwMTc2NDQxNTczNjI0KSByb3RhdGUoMCAtMTkuNjA4NzE0MDQzNTY3NTQ1IC0yNS42NzAzMzUwMTQ4NDk5NjgpIj48cGF0aCBkPSJNLTI5LjQyMDQ3NTMwMjAzMDM1OCAtMjEuMTM0MzgwNDE5MjM3MTU0IEMtMzQuNTE3NjY0NzMwMTM4MzY0IC0zMi4yMzY3OTEyMjA5NzQ4MSwgLTM2LjUxNTcxMjE4OTA1OTA5NCAtMzkuNDI1OTkyMzI0NDMyNDM2LCAtNDEuMTc5Njk0NzI2MDEwMTEgLTUwLjY5OTAxNzU4MDUzNTQxIE0tMzEuNDMzNzc3ODU4MjY5NDI2IC0yMS4yNjIwNzI2MzUzMTMxMSBDLTM0LjY3MzY3MzM5NDc0NDQ1IC0zMS4xMTQxMTM5MjIyMzUwMDYsIC0zNS45MjU4ODQ3MzQ2NzkxNDQgLTQwLjU2MTAxOTUyMzE0NTQ1NCwgLTM4LjU0OTkxMTY1MzUwMTI0IC01MC40NDAzMjQ1MDQ3OTY1NjQiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDguNTA3MTUxMDU3MjU0MzA1IDIwNy4wODIxNjEzODY5ODAyNikgcm90YXRlKDAgMjYuODczNjY2OTA1NTM0NjM0IDcuNjMwNzk0MzA2NTA5ODQxKSI+PHRleHQgeD0iMCIgeT0iMTIuMjYxNTg4NjEzMDE5NjgiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIFNlZ29lIFVJIEVtb2ppIiBmb250LXNpemU9IjEzLjI3MDk0NjYyMDAxNzA5MnB4IiBmaWxsPSJibGFjayIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIj5GYWNlIExpc3Q8L3RleHQ+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEwIDEwKSByb3RhdGUoMCA5MS45NTMyMDg4MTIzODY0OSA2Mi4xODA5MDgwMjEzMTE4MzYpIj48cGF0aCBkPSJNMzEuMDkwNDU0MDEwNjU1OTE1IDAgTTMxLjA5MDQ1NDAxMDY1NTkxNSAwIEM2MS4wMjY0NzI3NDM3Nzc3NDUgMCwgOTAuOTYyNDkxNDc2ODk5NTcgMCwgMTUyLjgxNTk2MzYxNDExNzEgMCBNMTUyLjgxNTk2MzYxNDExNzEgMCBDMTczLjU0MjkzMjk1NDU1NDM3IDAsIDE4My45MDY0MTc2MjQ3NzMgMTAuMzYzNDg0NjcwMjE4NjQsIDE4My45MDY0MTc2MjQ3NzMgMzEuMDkwNDU0MDEwNjU1OTE1IE0xODMuOTA2NDE3NjI0NzczIDMxLjA5MDQ1NDAxMDY1NTkxNSBDMTgzLjkwNjQxNzYyNDc3MyA1Mi42MjY4Mjg3MDA3OTU0MTQsIDE4My45MDY0MTc2MjQ3NzMgNzQuMTYzMjAzMzkwOTM0OTIsIDE4My45MDY0MTc2MjQ3NzMgOTMuMjcxMzYyMDMxOTY3NzQgTTE4My45MDY0MTc2MjQ3NzMgOTMuMjcxMzYyMDMxOTY3NzQgQzE4My45MDY0MTc2MjQ3NzMgMTEzLjk5ODMzMTM3MjQwNTAyLCAxNzMuNTQyOTMyOTU0NTU0MzcgMTI0LjM2MTgxNjA0MjYyMzY2LCAxNTIuODE1OTYzNjE0MTE3MSAxMjQuMzYxODE2MDQyNjIzNjYgTTE1Mi44MTU5NjM2MTQxMTcxIDEyNC4zNjE4MTYwNDI2MjM2NiBDMTIyLjM4MTg1MjIwNjMxMjg2IDEyNC4zNjE4MTYwNDI2MjM2NiwgOTEuOTQ3NzQwNzk4NTA4NiAxMjQuMzYxODE2MDQyNjIzNjYsIDMxLjA5MDQ1NDAxMDY1NTkxNSAxMjQuMzYxODE2MDQyNjIzNjYgTTMxLjA5MDQ1NDAxMDY1NTkxNSAxMjQuMzYxODE2MDQyNjIzNjYgQzEwLjM2MzQ4NDY3MDIxODY0IDEyNC4zNjE4MTYwNDI2MjM2NiwgMCAxMTMuOTk4MzMxMzcyNDA1MDIsIDAgOTMuMjcxMzYyMDMxOTY3NzQgTTAgOTMuMjcxMzYyMDMxOTY3NzQgQzAgNjguNzAxMDc4NjE1NDc1NTQsIDAgNDQuMTMwNzk1MTk4OTgzMzM2LCAwIDMxLjA5MDQ1NDAxMDY1NTkxNSBNMCAzMS4wOTA0NTQwMTA2NTU5MTUgQzAgMTAuMzYzNDg0NjcwMjE4NjQsIDEwLjM2MzQ4NDY3MDIxODY0IDAsIDMxLjA5MDQ1NDAxMDY1NTkxNSAwIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEuNSIgZmlsbD0ibm9uZSIgc3Ryb2tlLWRhc2hhcnJheT0iMyA2Ij48L3BhdGg+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEyMS44NDU1MTM2Mjc3NzM1OCAyMS40NjQ0OTk0NDQxMDQ5NDUpIHJvdGF0ZSgwIDMwLjg1NDk1MDg5MTUzOTc3MiA3LjYzMDc5NDMwNjUwOTg0MSkiPjx0ZXh0IHg9IjAiIHk9IjEyLjI2MTU4ODYxMzAxOTY4IiBmb250LWZhbWlseT0iSGVsdmV0aWNhLCBTZWdvZSBVSSBFbW9qaSIgZm9udC1zaXplPSIxMy4yNzA5NDY2MjAwMTcwOThweCIgZmlsbD0iYmxhY2siIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciI+RW50cnkgQXJlYTwvdGV4dD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNjUuOTEzMzg0ODEwNzE0ODkgMTM5LjEwNzQyODcwODQyNTgpIHJvdGF0ZSgwIDU5IDYpIj48dGV4dCB4PSIwIiB5PSIxMCIgZm9udC1mYW1pbHk9IkhlbHZldGljYSwgU2Vnb2UgVUkgRW1vamkiIGZvbnQtc2l6ZT0iMTAuNjE2NzU3Mjk2MDEzNjgxcHgiIGZpbGw9ImJsYWNrIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiPllvdSBjYW4gZHJhZyB5b3VyIGF2YXRhcjwvdGV4dD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjgwLjMxMjEzNTA1NjYwNzMgMzEuMjA4NDk0OTIwNTQxMTE0KSByb3RhdGUoMCA4NC4xOTkyMzE1Mzg2NjEyNSA1NS4yNTA2ODMyMzI4NjgwODQpIj48cGF0aCBkPSJNMC45NjU4MTM2NDIzNjc3MjA2IDAuNzkwMzMwNzMyMjQxMjcyOSBDNTkuOTI2MDgxODMzNzkyOTcgLTIuNTQwMDEwMzg1OTkwNzcwNiwgMTI0LjAzNTUyNTY2OTEzOTEyIC0xLjM3OTY0NTEwMjUwMTU0MzMsIDE2OC42ODM5NzY0MjQzMzczMiAtMS45ODUyMjYyNDkzMjIyOTUyIE0wLjA5NTA2MDI0MTQwODY0NjEgMC42NTI5MTMwMzY3NTYyMTc1IEM0NC4wNzQ5MTU2NTcwMzQ3NCAyLjI3MDc5MDQ0NjA5MDQyMDUsIDg2Ljk2ODg0NTk3MDQyNjk0IDEuNzY0MTc0NzE3OTUwNTQzMSwgMTY3LjkwMDA1OTIxMjQwOTg0IC0wLjQ1Mjk2MzIwMDM5Nzc4OTUgTTE2OC43MjgyNDgzNzAyOTA3IC0wLjkzNDEyMzEzNDI0MDUwODEgQzE2OC44ODkzMDA0MDE1ODA4NCAyMi41NjAxOTg5NDg1NDU2NDcsIDE2Ni4xOTM3ODU1NDM4MTE4MyA0NS42MTAzMzE5NTk2NzY1MywgMTY2LjQ5ODk0MjU2NjUxNDkgMTEwLjc0Njc4OTI3MDQ2NDMyIE0xNjcuNzg0NjI3MTg4NDA3NzcgLTAuNDcyMTkzODA0NTY5NTQyNCBDMTcwLjE2ODc0NzEyNTkzMjYgMjYuNDEwNDYzNzc4OTc1NzksIDE3MC4xNjQ0MTEzMzUwNjAwNCA1My42NjEwNzQ2NjI5OTcxOTQsIDE2OC41OTY0MTgzOTk3NzQ0MiAxMTAuMDAyNzM2NTQwODk0OTQgTTE2Ny42NTcyNDM0NDMxMzIzMyAxMTEuMDg4NDA0NDcwNTA3MDQgQzEwOC4wOTg4Njc4ODk0NjMyOSAxMTIuMjIzNzg5NzU4MzMzMzcsIDQ1LjEwOTQ2Nzc4NDQwMjY1IDExMy4wMzI5NTQ5MzgwNjI4MywgLTEuNjU0MzU3NjA2NTQ1MDkwNyAxMDkuMDA1MzQwOTI3NjY0MTggTTE2Ny40NDc3NzU2MjEzNzc4MiAxMDkuODY3MTgwNTU4MzA1MjIgQzEwNS43MTM1NTA4NTIyNzQ1NSAxMTAuOTMwNDI4ODY4NjYzMTYsIDQ0LjQ2MTgyMTM5MTA5MzYzNiAxMTEuNTU5NzcwODU4NDE4NzksIDAuODI0NDk1MDU5NDM4MDQ5OCAxMDkuNzAyMzgwNTk5ODM3NzQgTTEuMzcwNDEzNjA2OTg2NDAzNSAxMDkuNzM2NTg5MzA2NDE3ODQgQy0wLjk1ODA3OTU0MjQxNzAyMDUgNzYuMDExNzIyMjI5ODc4MzIsIC0xLjY2OTM5ODY5MDk1NzUxNzQgNDEuMDgxMDY5NDAxOTk2MDIsIDEuNTM1MTAxMTgwODk2MTYzIDAuODY5MTAzMDM4NjgzNTMzNyBNLTAuNzM3NDg1NDI2NDc4MDg3OSAxMTEuMzQyMzQ0OTQxOTU1MDUgQzAuMDAwNDM3MDA0Njg0Nzk5OTAyMDcgNzQuMjg0NjkzMTg4MTU4MzcsIC0xLjY5NDE0NzI3NTU2NzY1NjggMzkuMjQ0MzQ3NzYyMTgxNTMsIDAuODc2NjA3MTkxNzQ4OTE3MSAwLjcwNTc1MjkxMTk3NzQ2OTkiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzNTQuNjU5NDg1ODA1NzkyNjYgMTIuMDQ4MzI5Mjg0ODcxMDQ1KSByb3RhdGUoMCA0NC41IDcuNSkiPjx0ZXh0IHg9IjAiIHk9IjEyIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLCBTZWdvZSBVSSBFbW9qaSIgZm9udC1zaXplPSIxMy4yNzA5NDY2MjAwMTcxMXB4IiBmaWxsPSJibGFjayIgdGV4dC1hbmNob3I9InN0YXJ0IiBzdHlsZT0id2hpdGUtc3BhY2U6IHByZTsiIGRpcmVjdGlvbj0ibHRyIj5NZWV0aW5nIEFyZWEgMTwvdGV4dD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDc1LjAzODY5NzU1NjYwNzMgMzEuOTg5NzQ0OTIwNTQxMTE0KSByb3RhdGUoMCA4NC4xOTkyMzE1Mzg2NjEyNSA1NS4yNTA2ODMyMzI4NjgwODQpIj48cGF0aCBkPSJNMC4zOTU5MTA2NDQ5MDM3NzkwMyAtMC45OTcyNTk4NDk2ODI0NTAzIEM0OS41NDc4MTEzMzM3Nzk3OSAtMi42NDQ4MTQ3MzMxMjI5NTA2LCA5OC4xNDc2MTI3OTQ3NTA1MyAtMS43MDc3MDk3MzMxMDM4NzcsIDE2OC45ODU1MDEwODIwOTM0IDAuOTExNTI4Mjk0OTA2MDIwMiBNLTAuODI3MTc4ODAzMjcyNTQ1MyAtMC43NDgwMTI3NjkwMzU5OTUgQzU0LjQxNDI5ODUwNjE3MDU4IC0xLjg2NzE2Nzk0ODg3NjY3NDQsIDEwOC4wNTAzNDA0NDQyMTQ3OCAtMS45NTM5MTE2OTExMDQyMjg3LCAxNjcuNzY0Mjc3MTY5ODkxNTkgLTAuNzg3OTM3NTk5MjM0MjgzIE0xNzAuMDQ3NDUzMTk2MTk4NjMgLTEuNTk3OTcxNzMxNzk2ODYwNyBDMTY4LjU0NzMyMDQyMDk4MjA2IDI3Ljk1MjgxNjAwNDQ4NDI2LCAxNjcuNTk1MjA5MzU1NTk0MzMgNTUuODI4NzQzNzQwMTU1MDI2LCAxNjcuNjMzNjg1OTE4MDA0MiAxMDkuOTQzMTA5MDEwNzI5OTMgTTE2OS4xNjYwMTM2Njc3NzA2IDAuNDM0NTUxNTE5MzQxNzY2ODMgQzE2Ny45MzM0MDM0NzYxMjUxNiAzNS44OTcxOTM3MjM3NjQzOSwgMTY3Ljg0MjY3NTU4MDYyNjkgNjkuNDc5Mzg1Njc5NDY4NzUsIDE2OS4yMzk0NDE1NTM1NDE0IDExMS4zNzMzOTIwMjcyNTUxNCBNMTcwLjE1MTY3NzQ2MDgyMDM3IDExMS45MTI4NzIyODk2OTExMSBDMTI0LjMyMzg2MTkwNjM1OTYxIDExMS4yNjAyMzI3NTAwNzI3MywgODEuNjUxMTAwNDQ0MzA2MDggMTExLjc3MjIzMTcwMTUwNzgyLCAxLjY5ODQ4MDY4OTg5ODEzMzMgMTA5Ljg2Mjc0ODUzODUyNzYzIE0xNjguOTc3MjQ1MjUxMTI3NDcgMTEwLjg5NTY3ODIwMzkzNjY1IEMxMDYuOTczNTU2MDAyMTU1MzYgMTA4LjcyMDc4NTYzMTcwNDk0LCA0Ni4wMjk0MDk0MDkxMjgwOSAxMDkuMTUzMzI3MDkxNTAzNzUsIC0wLjY2NjYwNDIxODA3MzE4OTMgMTEwLjg0OTE1NTg1NDgxNzQ3IE0tMS45OTM5OTIyNDQ4MjQ3NjcxIDExMC41MDE3MTY1Mjk0MDI4NyBDMS43OTI3ODk2MTkxNDA0NzU3IDc1LjQzOTcxMTg2MzkxMTkxLCAwLjk4OTIzNDMwOTM2Nzk4NDQgNDAuMzA2MjQwNzUyNDk4MSwgMS41MzQwMDE0OTM4MjY1MDg1IC0wLjIxMzg5MTUwMDYwNzEzMjkgTS0wLjY5MzA3NTExNzY1NTA5ODQgMTExLjA3MjM2MjEzNjQ3OTQ2IEMwLjAyNjEwNjAyNDQ1MjQ0MzU4OCA4MC43ODcwMTA1NTUxNTE4LCAtMS4yNzgxNTE0NTc4Mzc4MjQ0IDUyLjAwNDA4MjI2MDI2MjEyLCAtMC42MDIwMzI4NjcyNjAyNzczIC0wLjcyODUzNTUyMDg0NDE2MTUiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1NDkuODA3OTIzMzA1NzkyNyAxMS42NjE2MTA1MzQ4NzEwNDUpIHJvdGF0ZSgwIDQ0LjUgNy41KSI+PHRleHQgeD0iMCIgeT0iMTIiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIFNlZ29lIFVJIEVtb2ppIiBmb250LXNpemU9IjEzLjI3MDk0NjYyMDAxNzExcHgiIGZpbGw9ImJsYWNrIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiPk1lZXRpbmcgQXJlYSAyPC90ZXh0PjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyOTMuMjM3OTE2MzA2NjA3MyAyMjkuMTEwODM4NjcwNTQxMSkgcm90YXRlKDAgMTc3LjY4OTQ2NTkxMzY2MTI1IDg5LjUxODI2MTM1Nzg2ODA2KSI+PHBhdGggZD0iTS0wLjU5MzUyMzcxOTEwNjI2NiAtMC4zNjYwNzgxMzM1MDc5MTI3NCBDODkuNzQ2Nzg5MTQ4NjQ0NzUgMC45MDk2ODU1MTA4ODEwNTA0LCAxNzguNzIxNTM1NjM2MDMzMiAwLjQzMDgxOTU0OTQ1NjcxMjg2LCAzNTUuNDk0NjU0NTY2OTA0IC0wLjgwMjUwMDk0NzMwMTI3ODIgTS0wLjUyNDE2Nzc4NjI0ODIyMjQgMC4yNzI3NTA2OTg1MTYyNzM4IEMxNDEuMzU0MDExMzUyNDM0NzggMC41NzQ1MjE2NDkwODMxNTQ3LCAyODIuNzQxMjAwODQ3MDIxODQgLTAuMDc1OTYwMzk0MTU3Njg4NDYsIDM1NS41NDU1OTkwMjYxNDY3NiAtMC40OTM5OTc1NDc1MDg2NDQxNiBNMzU3LjE4NzE0MTUwOTIwNTk2IDAuMDg5NTU0MTk2MjIzNjE2NiBDMzUzLjU4ODY4NTY2NjY4MDMgNjAuOTYwNDM3Mjg5MjU3ODEsIDM1NS4zNDAwNzE1MzQyNzYgMTI0LjA1MDE5ODE3NDY1MDQsIDM1Ny4yMDIyMjQ0MDQ5NjE3IDE3OS4xOTI1Mzc5Mzg2MjgzIE0zNTQuNTcxNDIzMDkzMjY3NjQgMC43NDU4OTg0Mzc2ODYyNjQ1IEMzNTQuMTkxNTA5OTM5MDY4NyA0NC41NjcxODg3MDAzNjQwMSwgMzU0LjQwMDc4MjIzNDMwNTI3IDg5LjIwNjE3OTM0OTA4OTExLCAzNTYuMjc2Mjk2ODYzNzQzIDE3OS43NDQxOTU3NzA4NTU5NSBNMzU2LjMwNTUzMDUxNTM2ODEgMTc4LjcxMTQ5MDQ2NDIwODMgQzI0NC45MDc2MTgzOTU3MzgyNCAxNzguNzQwMzE2Mzg5MTY1NDMsIDEzNS4yMDM5MzYxODk5ODQ1MiAxNzguNTkyNDcxMTExNTc3MiwgMC41NzUzNzQ0NjQ0MjM2ODA4IDE4MC4xOTIwNTQzODI3MTUyNyBNMzU1LjE0NDkwODA1Njc5NzkzIDE3OS4yNTQ1OTQ0MTE0Njk0NyBDMjUyLjkwNTc2NzY2NjE2Mzc0IDE4MC42MDg1ODg1OTkxNzcsIDE0OS42NzkyMDgwODA1MTE4IDE4MS4zNjMyMDE2NjI1NTg3NCwgLTAuNDYwMDQ4MTI4MjE4MDk2NSAxNzguNDU1MzMxNDI4NTAwMjQgTTAuNzY5OTA2NDI1ODQ4NjAzMiAxNzkuMTg5NjA0ODUzNjYzNTUgQzAuNTQzOTkwMDA5OTg2MDk0NiAxMjMuODQ4MjQ5Nzk4MTM0MTMsIC0wLjUwMzQ1NjA2MjExNTQ5ODQgNjYuMjAwMjU5ODM5NjUwNiwgLTAuMjQwNDEyNzQ3NDg3NDI1OCAtMC45NjM3MzM5NjU1MzA5OTE2IE0wLjg4ODYwMTkzMTc0MzMyMzggMTc4Ljc0MDM2OTg5NzcxOTQzIEMxLjMxNzU2MjMzNDk0NzU1MDcgMTI4Ljc0MzMxMzY0MjcwMzE2LCAxLjI1MjgxOTIwMzU0ODM5NiA3OS40MTc1MzQ0MzM4OTA1MSwgLTAuNTA3ODY3NDUyNjg4NTE1MiAwLjczMDE5MTI3MjY4MzQ0MTYiIHN0cm9rZT0iYmxhY2siIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSI+PC9wYXRoPjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNjEuNTQ2MjA0NTU1NzkyNjYgMTUxLjM3MjU0ODAzNDg3MTA0KSByb3RhdGUoMCAxOTcuODczMDQ2ODc1IDYuNTAyODcwMDg1MDkzODg5KSI+PHRleHQgeD0iMCIgeT0iMTAuMDA1NzQwMTcwMTg3Nzk0IiBmb250LWZhbWlseT0iSGVsdmV0aWNhLCBTZWdvZSBVSSBFbW9qaSIgZm9udC1zaXplPSIxMC44ODA1MTA4MDI4MDg3MjRweCIgZmlsbD0iYmxhY2siIHRleHQtYW5jaG9yPSJzdGFydCIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmU7IiBkaXJlY3Rpb249Imx0ciI+RHJhZyB5b3UgYXZhdGFyIGludG8gYSBtZWV0aW5nIGFyZWEgYW5kIHlvdSBjYW4gdGFsayB3aXRoIG90aGVycyBpbiB0aGUgc2FtZSBhcmVhPC90ZXh0PjwvZz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1ODEuMDMwNTc5NTU1NzkyNyAyMDYuMjQzNjQxNzg0ODcxMDQpIHJvdGF0ZSgwIDI5LjUgNy41KSI+PHRleHQgeD0iMCIgeT0iMTIiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIFNlZ29lIFVJIEVtb2ppIiBmb250LXNpemU9IjEzLjI3MDk0NjYyMDAxNzExcHgiIGZpbGw9ImJsYWNrIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiPkNoYXQgQXJlYTwvdGV4dD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjQuNjMyNDQ3NTU2NjA3MzAzIDI1My41NjM5NjM2NzA1NDExKSByb3RhdGUoMCAxMTYuMjU1ODcyMTYzNjYxMjUgNzYuOTU3NzE0NDgyODY4MDYpIj48cGF0aCBkPSJNMS4xMzg4NTQxNzQyNTE2MjE2IDEuMDkwMzgyOTA5MDMzODU4NCBDNTcuODAwMDQ1MDg4OTY3MzggLTIuOTg2OTUwOTgwMDcxMjU5LCAxMTguNTY3NzA5MzQwMzk2NjggLTIuNzQ1NTE2MzE5NTY3MzYyNiwgMjMzLjAzNDkyMDQwODQ3NTIgLTAuODYwNDQzODk4MjY1MjQyMyBNLTAuMzg4NjE3MjcwMzg0NTM3NzUgMC41MzIwOTc5MDI3Mjg5MDc2IEM3My4yNjc5NTc3ODIxNTg1NSAwLjU2NTUyMzg3OTk0NzI3NTYsIDE0Ni4xODk4NTE1NjY0ODE5IDEuMzg0NDA0NjM0NzM3NjA3MywgMjMyLjExODExNjI2OTMwOTM1IDAuNTUwNDI3NzA0NzE0MTAzOCBNMjM0LjMyMjI5MTE0ODMwNTggMC45MDU1OTU2ODQ0MjQwNDI3IEMyMzEuOTQxNzIwMDI1MDM1NCA0OC45MTEwMjMxMjI1NDg2MiwgMjM1LjAwNzM0NDA4MzI4MjAyIDEwMC40NjkzMzE4MDE1MTc5MiwgMjMzLjc4MjY1MjA5MjU3Njg4IDE1My45MDQxNjU1NTk4MzE5NCBNMjMxLjYyMDczMTEwNDU3NTk1IC0wLjA5OTI3NTE5ODc2NTA5OTA1IEMyMzMuMDM5NjcyODQyMTU3NTYgNDguMTE5NDM3ODI5Njc2NCwgMjMyLjY5OTQ0NTMyNzY1MjE3IDk3LjUxMjI1NjUwMjM0Mzk3LCAyMzIuOTcxNzIyMTQ1MDQ0MTcgMTUzLjUwNDY2ODIwODIyMjc3IE0yMzMuMjE3NzQxOTI4MjM3NDQgMTU0LjgxOTg4MDU1MTY4MjEzIEMxNTguMzA2MzgxNzk2ODY0IDE1NC42NDYzMzQ0MDcxMzQ2NywgODMuNTc0Nzc2MTMxODI5NSAxNTMuNzE2ODYzNzYzODUyODQsIC0xLjAwMDI5OTg2NjM0MDg3NjYgMTUyLjUyNDcyMTgzMzYwNTcyIE0yMzIuMTM5Mzg2NTg5MDQwMiAxNTQuNDI0MzgyOTg4ODk2NyBDMTUyLjU2NjcyMTMwNjMzNzY4IDE1NC45MDI5MTczMjUwNTY1NiwgNzQuMDM1MjQxMTg1MzU0NjggMTU0LjExOTYxNzI0MzMzMTAyLCAtMC41NTcwMTk3NDcyMDI5MDczIDE1My40NzAyNzgzNDQ2MDEyIE0tMS4yNDQ1ODkwMjUxNTQ3MDk4IDE1Mi4zNTg1OTU3MjI3Mzg1OCBDLTMuMDgxNzg3MDM3Nzk3NTExIDEwNC44NjgxNTc5NTc3ODc4NiwgLTIuNDA1MDE0MTQ1MzIyMzgzIDU3LjIzMTUwNDc1Mzk5NDM2LCAxLjQ5MDYyNDY3MTgwMTkyNDcgMS45NDM1MzI1NTA3MDc0NTk0IE0tMC4wMzg1NTgwMjM5ODE3NTAwMSAxNTQuNjgxMDUzMzQyNjgxMyBDMC40OTg0MjQ1ODc0MjE1MDMyIDEwNi4yMzM5OTIzNDgwODk1NCwgMC40NTEzNDcwMjEwMzYyMzQwMyA1Ny41NzkxNDAwMjUwNjc1OSwgLTAuOTM1MDcwMjY0MTUzMTgyNSAtMC43NzY3MjA5MzgyNzI3NzQyIiBzdHJva2U9ImJsYWNrIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPjwvcGF0aD48L2c+PGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTEyLjk4MzcwNDU1NTc5MjY2IDIzMC4wODM0ODU1MzQ4NzEwNCkgcm90YXRlKDAgNzEgNy41KSI+PHRleHQgeD0iMCIgeT0iMTIiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsIFNlZ29lIFVJIEVtb2ppIiBmb250LXNpemU9IjEzLjI3MDk0NjYyMDAxNzExcHgiIGZpbGw9ImJsYWNrIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHN0eWxlPSJ3aGl0ZS1zcGFjZTogcHJlOyIgZGlyZWN0aW9uPSJsdHIiPlZpZGUvU2NyZWVuIFNoYXJlIEFyZWE8L3RleHQ+PC9nPjwvc3ZnPg==) left top / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n  chat: {\n    type: \"chat\",\n    position: [392, 313],\n    size: [415, 208],\n    zIndex: 0,\n    background: \"rgba(135, 206, 235, 0.2)\",\n    border: \"\",\n    iframe: \"\",\n  },\n  ...createMeeting(1, 382, 82, 180, 115),\n  ...createMeeting(2, 614, 82, 180, 115),\n  share: {\n    type: \"media\",\n    position: [69, 343],\n    size: [272, 177],\n    zIndex: 0,\n    background: \"rgba(0, 240, 0, 0.2)\",\n    border: \"\",\n    iframe: \"\",\n  },\n};\n\nconst phone: Record<string, RegionData> = {\n  ...createMeeting(0, 45, 40, 45, 500),\n  share: {\n    type: \"media\",\n    position: [100, 40],\n    size: [1000, 500],\n    zIndex: 0,\n    background: \"rgba(0, 240, 0, 0.2)\",\n    border: \"\",\n    iframe: \"\",\n  },\n};\n\nconst igo: Record<string, RegionData> = {\n  chat: {\n    type: \"chat\",\n    position: [45, 200],\n    size: [240, 310],\n    zIndex: 0,\n    background: \"rgba(135, 206, 235, 0.2)\",\n    border: \"\",\n    iframe: \"\",\n  },\n  ...createGoBoard(1, 300, 40),\n  ...createGoBoard(2, 300, 200),\n  ...createGoBoard(3, 300, 360),\n  ...createGoBoard(4, 560, 40),\n  ...createGoBoard(5, 560, 200),\n  ...createGoBoard(6, 560, 360),\n  ...createGoBoard(7, 820, 40),\n  ...createGoBoard(8, 820, 200),\n  ...createGoBoard(9, 820, 360),\n};\n\nconst office1: Record<string, RegionData> = {\n  background: {\n    type: \"background\",\n    position: [0, 0],\n    size: [1021, 676],\n    zIndex: -100,\n    background:\n      \"url(https://user-images.githubusercontent.com/17561803/111254880-55862c80-8659-11eb-88f1-3aaa42ba2b68.png) left top / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n  chat: {\n    type: \"chat\",\n    position: [40, 480],\n    size: [380, 190],\n    zIndex: 0,\n    background: \"white\",\n    border: \"skyblue solid 3px\",\n    iframe: \"\",\n  },\n  ...createMeeting(1, 77, 244, 273, 230),\n  ...createMeeting(2, 297, 41, 135, 125),\n  ...createMeeting(3, 385, 321, 113, 75),\n  share: {\n    type: \"media\",\n    position: [540, 405],\n    size: [480, 270],\n    zIndex: 0,\n    background: \"rgba(0, 240, 0, 0.3)\",\n    border: \"\",\n    iframe: \"\",\n  },\n  go: {\n    type: \"goboard\",\n    position: [820, 95],\n    size: [200, 120],\n    zIndex: 0,\n    background: \"rgba(0,240,0,0.6)\",\n    border: \"\",\n    iframe: \"\",\n  },\n  go2: {\n    type: \"goboard\",\n    position: [820, 220],\n    size: [200, 120],\n    zIndex: 0,\n    background: \"rgba(0,100,240,0.6)\",\n    border: \"\",\n    iframe: \"\",\n  },\n};\n\nconst office2: Record<string, RegionData> = {\n  background: {\n    type: \"background\",\n    position: [0, 0],\n    size: [1120, 740],\n    zIndex: -100,\n    background:\n      \"url(https://user-images.githubusercontent.com/17561803/118205142-ab7d2200-b49a-11eb-863a-3a9a5560d7df.png) left top / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n  chat: {\n    type: \"chat\",\n    position: [85, 530],\n    size: [375, 200],\n    zIndex: 0,\n    background: \"rgba(206,206,206,0.9)\",\n    border: \"#2C2F33 solid 2px\",\n    iframe: \"\",\n  },\n  ...createMeeting(1, 220, 180, 240, 180),\n  ...createMeeting(2, 863, 230, 250, 230),\n  ...createMeeting(3, 650, 47, 160, 160),\n  ...createMeeting(4, 64, 315, 100, 45),\n  ...createMeeting(5, 64, 388, 100, 45),\n  ...createMeeting(6, 64, 457, 100, 45),\n  share: {\n    type: \"media\",\n    position: [600, 480],\n    size: [510, 250],\n    zIndex: 0,\n    background: \"rgba(0,0,0,0.2)\",\n    border: \"limegreen solid 2px\",\n    iframe: \"\",\n  },\n  ...createGoBoard(10, 865, 5),\n};\n\nconst office3: Record<string, RegionData> = {\n  background: {\n    type: \"background\",\n    position: [0, 0],\n    size: [1120, 740],\n    zIndex: -100,\n    background:\n      \"url(https://user-images.githubusercontent.com/17561803/120201967-fc459680-c260-11eb-8b1f-6bb108476f2f.png) left top / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n  chat: {\n    type: \"chat\",\n    position: [56, 340],\n    size: [250, 394],\n    zIndex: 0,\n    background: \"rgba(167,194,211,0.9)\",\n    border: \"#2C2F33 solid 3px\",\n    iframe: \"\",\n  },\n  ...createMeeting(1, 575, 295, 200, 130),\n  ...createMeeting(2, 516, 555, 200, 180),\n  ...createMeeting(3, 441, 373, 100, 100),\n  ...createMeeting(4, 684, 17, 100, 45),\n  ...createMeeting(5, 684, 83, 100, 45),\n  ...createMeeting(6, 684, 149, 100, 45),\n  share: {\n    type: \"media\",\n    position: [763, 643],\n    size: [350, 90],\n    zIndex: 0,\n    background: \"rgba(167,194,211,0.6)\",\n    border: \"#2C2F33 solid 3px\",\n    iframe: \"\",\n  },\n  go: {\n    type: \"goboard\",\n    position: [320, 594],\n    size: [180, 140],\n    zIndex: 0,\n    background: \"rgba(167,194,211,0.6)\",\n    border: \"#2C2F33 solid 3px\",\n    iframe: \"\",\n  },\n  movable1: {\n    type: \"background\",\n    position: [244, 109],\n    size: [36, 36],\n    zIndex: 0,\n    background:\n      \"url(https://user-images.githubusercontent.com/17561803/120613305-12d23480-c491-11eb-91ba-d338c3ba631e.png) center center / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n};\n\nconst office4: Record<string, RegionData> = {\n  background: {\n    type: \"background\",\n    position: [0, 0],\n    size: [1120, 740],\n    zIndex: -100,\n    background:\n      \"url(https://user-images.githubusercontent.com/17561803/126063504-6168d990-c144-44b7-a715-310e76e24777.png) left top / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  },\n  chat: {\n    type: \"chat\",\n    position: [60, 480],\n    size: [250, 250],\n    zIndex: 0,\n    background: \"rgba(255,255,255,0.6)\",\n    border: \"#ffffff solid 1px\",\n    iframe: \"\",\n  },\n  ...createMeeting(1, 160, 310, 270, 160),\n  ...createMeeting(2, 50, 320, 100, 100),\n  ...createMeeting(3, 820, 180, 160, 80),\n  ...createMeeting(4, 990, 310, 100, 45),\n  movie: {\n    type: \"background\",\n    position: [762, 290],\n    size: [105, 58],\n    zIndex: 0,\n    background: \"\",\n    border: \"\",\n    iframe: \"https://www.youtube.com/embed/eYsPmVUAzqE\",\n  },\n  share: {\n    type: \"media\",\n    position: [760, 590],\n    size: [350, 140],\n    zIndex: 0,\n    background: \"rgba(255,255,255,0.6)\",\n    border: \"#ffffff solid 1px\",\n    iframe: \"\",\n  },\n  go: {\n    type: \"goboard\",\n    position: [320, 590],\n    size: [180, 140],\n    zIndex: 0,\n    background: \"rgba(255,255,255,0.6)\",\n    border: \"#ffffff solid 1px\",\n    iframe: \"\",\n  },\n};\n[...Array(100).keys()].forEach((i) => {\n  const x = 700 - 14 * (i % 10);\n  const y = 700 - 14 * Math.floor(i / 10);\n  office4[`block${i}`] = {\n    type: \"background\",\n    position: [x, y],\n    size: [36, 36],\n    zIndex: 0,\n    background:\n      \"url(https://user-images.githubusercontent.com/52230939/121129812-73ce8380-c868-11eb-8e51-2c721a239df6.png) center center / contain no-repeat\",\n    border: \"\",\n    iframe: \"\",\n  };\n});\n\nexport const roomPresets: Record<string, Record<string, RegionData>> = {\n  intro,\n  phone,\n  igo,\n  office1,\n  office2,\n  office3,\n  office4,\n};\n","import { useCallback, useState, useRef, useEffect } from \"react\";\nimport { subscribe } from \"valtio\";\n\nimport { getRoomState } from \"../states/roomMap\";\nimport { roomPresets } from \"../states/roomPresets\";\nimport { getRoomPresetFromUrl } from \"../utils/url\";\n\nconst getInitialPosition = (uid: string): [number, number] => [\n  parseInt(uid.slice(0, 2), 16) / 2 + 50,\n  parseInt(uid.slice(2, 4), 16) / 2 + 30,\n];\n\nexport type AvatarData = {\n  position: [left: number, top: number];\n};\n\nconst isAvatarData = (x: unknown): x is AvatarData => {\n  try {\n    const obj = x as AvatarData;\n    if (\n      typeof obj.position[0] === \"number\" &&\n      typeof obj.position[1] === \"number\"\n    ) {\n      return true;\n    }\n    return false;\n  } catch (e) {\n    return false;\n  }\n};\n\nconst isEqualAvatarData = (a: AvatarData, b: AvatarData) =>\n  a.position[0] === b.position[0] && a.position[1] === b.position[1];\n\nexport type RegionData = {\n  type: \"background\" | \"meeting\" | \"chat\" | \"media\" | \"goboard\";\n  position: [left: number, top: number];\n  size: [width: number, height: number];\n  zIndex?: number;\n  background?: string;\n  border?: string;\n  iframe?: string;\n};\n\nconst isRegionData = (x: unknown): x is RegionData => {\n  try {\n    const obj = x as RegionData;\n    if (\n      [\"background\", \"meeting\", \"chat\", \"media\", \"goboard\"].includes(\n        obj.type\n      ) &&\n      typeof obj.position[0] === \"number\" &&\n      typeof obj.position[1] === \"number\" &&\n      typeof obj.size[0] === \"number\" &&\n      typeof obj.size[1] === \"number\" &&\n      (typeof obj.zIndex === \"undefined\" || typeof obj.zIndex === \"number\") &&\n      (typeof obj.background === \"undefined\" ||\n        typeof obj.background === \"string\") &&\n      (typeof obj.border === \"undefined\" || typeof obj.border === \"string\") &&\n      (typeof obj.iframe === \"undefined\" || typeof obj.iframe === \"string\")\n    ) {\n      return true;\n    }\n    return false;\n  } catch (e) {\n    return false;\n  }\n};\n\nconst isEqualRegionData = (a: RegionData, b: RegionData) =>\n  a.type === b.type &&\n  a.position[0] === b.position[0] &&\n  a.position[1] === b.position[1] &&\n  a.size[0] === b.size[0] &&\n  a.size[1] === b.size[1] &&\n  a.zIndex === b.zIndex &&\n  a.background === b.background &&\n  a.border === b.border &&\n  a.iframe === b.iframe;\n\nexport type AvatarMap = {\n  [userId: string]: AvatarData;\n};\n\nexport type RegionMap = {\n  [regionId: string]: RegionData;\n};\n\nexport const ROOM_STATE_KEY = \"gatherRegionMap\";\n\nexport const useGatherArea = (roomId: string, userId: string) => {\n  const [avatarMap, setAvatarMap] = useState<AvatarMap>({});\n  const [myAvatar, setMyAvatar] = useState<AvatarData>({\n    position: getInitialPosition(userId),\n  });\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(\"gatherAvatarMap\");\n    const listener = () => {\n      setAvatarMap((prev) => {\n        const copied = { ...prev };\n        let changed = false;\n        map.forEach((data, uid) => {\n          if (uid === userId) return;\n          if (!roomState.userIdMap[uid]) return;\n          if (!isAvatarData(data)) return;\n          if (!copied[uid]) {\n            copied[uid] = data;\n            changed = true;\n          } else if (!isEqualAvatarData(data, copied[uid])) {\n            copied[uid] = data;\n            changed = true;\n          }\n        });\n        Object.keys(copied).forEach((uid) => {\n          if (!roomState.userIdMap[uid]) {\n            delete copied[uid];\n            changed = true;\n          }\n        });\n        if (changed) {\n          return copied;\n        }\n        return prev;\n      });\n    };\n    map.observe(listener);\n    const unsub = subscribe(roomState.userIdMap, listener);\n    listener();\n    return () => {\n      unsub();\n      map.unobserve(listener);\n    };\n  }, [roomId, userId]);\n\n  const dataToBroadcast = useRef<AvatarData>();\n  useEffect(() => {\n    if (!myAvatar) return;\n    if (dataToBroadcast.current) {\n      dataToBroadcast.current = myAvatar;\n    } else {\n      dataToBroadcast.current = myAvatar;\n      setTimeout(() => {\n        const roomState = getRoomState(roomId, userId);\n        const map = roomState.ydoc.getMap(\"gatherAvatarMap\");\n        map.set(userId, dataToBroadcast.current);\n        dataToBroadcast.current = undefined;\n      }, 500);\n    }\n  }, [roomId, userId, myAvatar]);\n\n  const [regionMap, setRegionMap] = useState<RegionMap>({});\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n    const listener = () => {\n      setRegionMap((prev) => {\n        const next: RegionMap = {};\n        map.forEach((data, id) => {\n          if (!isRegionData(data)) return;\n          if (prev[id] && isEqualRegionData(prev[id], data)) {\n            next[id] = prev[id];\n          } else {\n            next[id] = data;\n          }\n        });\n        return next;\n      });\n    };\n    map.observe(listener);\n    listener();\n    const timer = setTimeout(() => {\n      const roomPreset = getRoomPresetFromUrl() || \"\";\n      const preset = roomPresets[roomPreset];\n      if (!preset) return;\n      if (map.size > 0) return;\n      Object.entries(preset).forEach(([key, value]) => {\n        map.set(key, value);\n      });\n    }, 10 * 1000);\n    return () => {\n      clearTimeout(timer);\n      map.unobserve(listener);\n    };\n  }, [roomId, userId]);\n\n  const timerMap = useRef<{ [id: string]: NodeJS.Timeout }>({});\n  const updateRegion = useCallback(\n    (id: string, data: RegionData) => {\n      clearTimeout(timerMap.current[id]);\n      timerMap.current[id] = setTimeout(() => {\n        const roomState = getRoomState(roomId, userId);\n        const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n        map.set(id, data);\n      }, 500);\n    },\n    [roomId, userId]\n  );\n\n  return {\n    avatarMap,\n    myAvatar,\n    setMyAvatar,\n    regionMap,\n    updateRegion,\n  };\n};\n","import { sleep } from \"../utils/sleep\";\n\nconst captureImage = async (stream: MediaStream, track: MediaStreamTrack) => {\n  if (typeof ImageCapture !== \"undefined\") {\n    const imageCapture = new ImageCapture(track);\n    await sleep(2000);\n    let srcImg: ImageBitmap;\n    try {\n      const blob = await imageCapture.takePhoto();\n      srcImg = await createImageBitmap(blob);\n    } catch (e) {\n      srcImg = await imageCapture.grabFrame();\n    }\n    const srcW = srcImg.width;\n    const srcH = srcImg.height;\n    return { srcImg, srcW, srcH };\n  }\n  const video = document.createElement(\"video\");\n  video.autoplay = true;\n  video.setAttribute(\"playsinline\", \"\");\n  video.style.display = \"block\";\n  video.style.width = \"1px\";\n  video.style.height = \"1px\";\n  video.style.position = \"absolute\";\n  video.style.bottom = \"0\";\n  document.body.appendChild(video);\n  const dispose = () => {\n    document.body.removeChild(video);\n  };\n  video.srcObject = stream;\n  await sleep(2000);\n  const srcImg = video;\n  const srcW = video.videoWidth;\n  const srcH = video.videoHeight;\n  return { srcImg, srcW, srcH, dispose };\n};\n\nexport const takePhoto = async (deviceId?: string) => {\n  const constraints = {\n    video: {\n      deviceId,\n      width: 1280,\n      height: 720,\n    },\n  };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const canvas = document.createElement(\"canvas\");\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  const dstW = 72;\n  const dstH = 72;\n  canvas.width = dstW;\n  canvas.height = dstH;\n  const { srcImg, srcW, srcH, dispose } = await captureImage(stream, track);\n  const ratio = Math.max(dstW / srcW, dstH / srcH);\n  const width = Math.min(srcW, dstW / ratio);\n  const height = Math.min(srcH, dstH / ratio);\n  const x = (srcW - width) / 2;\n  const y = (srcH - height) / 2;\n  ctx.drawImage(srcImg, x, y, width, height, 0, 0, dstW, dstH);\n  if (dispose) {\n    dispose();\n  }\n  track.stop();\n  return canvas.toDataURL(\"image/jpeg\");\n};\n","import { useEffect, useState } from \"react\";\nimport { subscribe } from \"valtio\";\n\nimport { isObject } from \"../utils/types\";\nimport { takePhoto } from \"../media/capture\";\nimport { getRoomState } from \"../states/roomMap\";\n\ntype ImageUrl = string;\n\ntype FaceInfo = {\n  nickname: string;\n  message: string;\n  liveMode: boolean;\n  micOn: boolean;\n  speakerOn: boolean;\n};\n\nconst isFaceInfo = (x: unknown): x is FaceInfo =>\n  isObject(x) &&\n  typeof (x as { nickname: unknown }).nickname === \"string\" &&\n  typeof (x as { message: unknown }).message === \"string\" &&\n  typeof (x as { liveMode: unknown }).liveMode === \"boolean\" &&\n  typeof (x as { micOn: unknown }).micOn === \"boolean\" &&\n  typeof (x as { speakerOn: unknown }).speakerOn === \"boolean\";\n\ntype ImageData = {\n  userId: string;\n  image: ImageUrl;\n  info: FaceInfo;\n  updated: number; // in milliseconds\n};\n\nconst isImageData = (x: unknown): x is ImageData =>\n  isObject(x) &&\n  typeof (x as { image: unknown }).image === \"string\" &&\n  isFaceInfo((x as { info: unknown }).info) &&\n  typeof (x as { updated: unknown }).updated === \"number\";\n\nexport const useFaceImages = (\n  roomId: string,\n  userId: string,\n  avatar: string,\n  nickname: string,\n  statusMesg: string,\n  suspended: boolean,\n  liveMode: boolean,\n  micOn: boolean,\n  speakerOn: boolean,\n  deviceId?: string\n) => {\n  const [myImage, setMyImage] = useState<ImageUrl>();\n  const [roomImages, setRoomImages] = useState<ImageData[]>([]);\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(\"faceImages\");\n    const listener = () => {\n      setRoomImages((prev) => {\n        const copied = [...prev];\n        let changed = false;\n        map.forEach((data, uid) => {\n          if (uid === userId) return;\n          // FIXME for now we don't delete unknown/not-connected user\n          // if (!roomState.userIdMap[uid]) return;\n          if (!isImageData(data)) return;\n          const index = copied.findIndex((item) => item.userId === uid);\n          if (index === -1) {\n            copied.push(data);\n            changed = true;\n          } else if (data.updated > copied[index].updated) {\n            copied[index] = data;\n            changed = true;\n          }\n        });\n        const tenMinAgo = Date.now() - 10 * 60 * 1000;\n        const filtered = copied.filter(\n          (item) =>\n            item.updated >= tenMinAgo && roomState.userIdMap[item.userId]\n        );\n        changed = changed || copied.length !== filtered.length;\n        if (changed) {\n          return filtered;\n        }\n        return prev;\n      });\n    };\n    map.observe(listener);\n    const unsub = subscribe(roomState.userIdMap, listener);\n    listener();\n    return () => {\n      unsub();\n      map.unobserve(listener);\n    };\n  }, [roomId, userId]);\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(\"faceImages\");\n    let didCleanup = false;\n    let timer: NodeJS.Timeout;\n    const loop = async () => {\n      if (didCleanup) return;\n      try {\n        const image = suspended ? avatar : await takePhoto(deviceId);\n        if (didCleanup) return;\n        setMyImage(image);\n        const info: FaceInfo = {\n          nickname,\n          message: statusMesg,\n          liveMode,\n          micOn,\n          speakerOn,\n        };\n        const data: ImageData = {\n          userId,\n          image,\n          info,\n          updated: Date.now(),\n        };\n        map.set(userId, data);\n        // XXX force update all images for debug\n        roomState.ydoc.transact(() => {\n          const twoMinAgo = Date.now() - 2 * 60 * 1000;\n          map.forEach((value, key) => {\n            if (value.updated >= twoMinAgo) {\n              map.set(key, { ...value });\n            }\n          });\n        });\n      } catch (e) {\n        console.error(e);\n      }\n      timer = setTimeout(loop, 2 * 60 * 1000);\n    };\n    loop();\n    return () => {\n      didCleanup = true;\n      clearTimeout(timer);\n    };\n  }, [\n    roomId,\n    userId,\n    deviceId,\n    avatar,\n    nickname,\n    statusMesg,\n    suspended,\n    liveMode,\n    micOn,\n    speakerOn,\n  ]);\n\n  return {\n    myImage,\n    roomImages,\n  };\n};\n\nexport const useFaceImageObsoleted = (\n  updated?: number // in milliseconds\n) => {\n  const [obsoleted, setObsoleted] = useState(false);\n  useEffect(() => {\n    if (updated) {\n      const callback = () => {\n        const twoMinAgo = Date.now() - 2 * 60 * 1000;\n        setObsoleted(updated < twoMinAgo);\n      };\n      const timer = setInterval(callback, 10 * 1000);\n      callback();\n      return () => clearInterval(timer);\n    }\n    return undefined;\n  }, [updated]);\n  return obsoleted;\n};\n","export const getAudioStream = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        audio: { deviceId },\n      }\n    : { audio: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getAudioTracks();\n  await track.applyConstraints({\n    echoCancellation: true,\n    echoCancellationType: { ideal: \"system\" },\n    noiseSuppression: { ideal: true },\n  } as MediaTrackConstraints);\n  const dispose = () => {\n    track.stop();\n  };\n  return {\n    stream,\n    dispose,\n  };\n};\n","import { useEffect, useState, useRef } from \"react\";\nimport { useSnapshot } from \"valtio\";\n\nimport { getFaceVideoStream } from \"../media/video\";\nimport { getAudioStream } from \"../media/audio\";\nimport { getRoomState } from \"../states/roomMap\";\n\nconst addTrackToStream = (\n  track: MediaStreamTrack,\n  stream: MediaStream | null,\n  disposeStream: (s: MediaStream) => void\n) => {\n  const newStream = stream || new MediaStream();\n  newStream.addTrack(track);\n  newStream.dispatchEvent(new MediaStreamTrackEvent(\"addtrack\", { track }));\n  track.addEventListener(\"ended\", () => {\n    newStream.removeTrack(track);\n    if (newStream.getTracks().length === 0) {\n      disposeStream(newStream);\n    }\n  });\n  return newStream;\n};\n\nexport const useFaceVideos = (\n  roomId: string,\n  userId: string,\n  videoEnabled: boolean,\n  audioEnabled: boolean,\n  micOn: boolean,\n  videoDeviceId?: string,\n  audioDeviceId?: string,\n  uniqueMediaId?: string\n) => {\n  const videoType = `${uniqueMediaId || \"face\"}Video`;\n  const audioType = `${uniqueMediaId || \"face\"}Audio`;\n  const [faceStream, setFaceStream] = useState<MediaStream | null>(null);\n  const [faceStreamMap, setFaceStreamMap] = useState<{\n    [userId: string]: MediaStream;\n  }>({});\n\n  const isMounted = useRef(true);\n  useEffect(() => {\n    const cleanup = () => {\n      isMounted.current = false;\n    };\n    return cleanup;\n  }, []);\n\n  useEffect(() => {\n    if (!videoEnabled && !audioEnabled) {\n      // clear face stream map immediately\n      setFaceStreamMap({});\n    }\n  }, [videoEnabled, audioEnabled]);\n\n  const onTrack = ([uid, track]: [string, MediaStreamTrack]) => {\n    if (track.readyState === \"ended\") return;\n    if (faceStreamMap[uid]?.getTracks().includes(track)) return;\n    const disposeStream = (s: MediaStream) => {\n      if (isMounted.current) {\n        setFaceStreamMap((prev) => {\n          const { [uid]: oldStream, ...rest } = prev;\n          if (oldStream === s) {\n            return rest;\n          }\n          return prev;\n        });\n      }\n    };\n    setFaceStreamMap((prev) => {\n      const stream = prev[uid];\n      const newStream = addTrackToStream(track, stream, disposeStream);\n      if (stream === newStream) {\n        return prev;\n      }\n      return { ...prev, [uid]: newStream };\n    });\n  };\n\n  const trackMap = useSnapshot(getRoomState(roomId, userId).trackMap);\n  Object.entries(trackMap[videoType] || {}).forEach(onTrack);\n  Object.entries(trackMap[audioType] || {}).forEach(onTrack);\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    let cleanup: (() => void) | null | false = null;\n    if (videoEnabled) {\n      (async () => {\n        const {\n          stream: videoStream,\n          dispose: disposeVideo,\n        } = await getFaceVideoStream(videoDeviceId);\n        const [videoTrack] = videoStream.getVideoTracks();\n        roomState.addMediaType(videoType);\n        roomState.addTrack(videoType, videoTrack);\n        const disposeStream = (s: MediaStream) => {\n          if (isMounted.current) {\n            setFaceStream((prev) => (prev === s ? null : prev));\n          }\n        };\n        setFaceStream((prev) =>\n          addTrackToStream(videoTrack, prev, disposeStream)\n        );\n        const dispose = () => {\n          roomState.removeMediaType(videoType);\n          roomState.removeTrack(videoType);\n          disposeVideo();\n          // XXX we need to manually dispatch ended event, why?\n          videoTrack.dispatchEvent(new Event(\"ended\"));\n        };\n        if (cleanup === false) {\n          dispose();\n        } else {\n          cleanup = dispose;\n        }\n      })();\n    }\n    return () => {\n      if (cleanup) cleanup();\n      cleanup = false;\n    };\n  }, [roomId, userId, videoEnabled, videoDeviceId, videoType]);\n\n  useEffect(() => {\n    const roomState = getRoomState(roomId, userId);\n    let cleanup: (() => void) | null | false = null;\n    if (audioEnabled) {\n      (async () => {\n        const {\n          stream: audioStream,\n          dispose: disposeAudio,\n        } = await getAudioStream(audioDeviceId);\n        const [audioTrack] = audioStream.getAudioTracks();\n        roomState.addMediaType(audioType);\n        roomState.addTrack(audioType, audioTrack);\n        const disposeStream = (s: MediaStream) => {\n          if (isMounted.current) {\n            setFaceStream((prev) => (prev === s ? null : prev));\n          }\n        };\n        setFaceStream((prev) =>\n          addTrackToStream(audioTrack, prev, disposeStream)\n        );\n        const dispose = () => {\n          roomState.removeMediaType(audioType);\n          roomState.removeTrack(audioType);\n          disposeAudio();\n          // XXX we need to manually dispatch ended event, why?\n          audioTrack.dispatchEvent(new Event(\"ended\"));\n        };\n        if (cleanup === false) {\n          dispose();\n        } else {\n          cleanup = dispose;\n        }\n      })();\n    }\n    return () => {\n      if (cleanup) cleanup();\n      cleanup = false;\n    };\n  }, [roomId, userId, audioEnabled, audioDeviceId, audioType]);\n\n  useEffect(() => {\n    if (faceStream) {\n      faceStream.getAudioTracks().forEach((track) => {\n        const audioTrack = track;\n        audioTrack.enabled = micOn;\n      });\n      const onaddtrack = (event: MediaStreamTrackEvent) => {\n        const { track } = event;\n        if (track.kind === \"audio\") {\n          track.enabled = micOn;\n        }\n      };\n      faceStream.addEventListener(\"addtrack\", onaddtrack);\n      return () => {\n        faceStream.removeEventListener(\"addtrack\", onaddtrack);\n      };\n    }\n    return undefined;\n  }, [faceStream, micOn]);\n\n  return { faceStream, faceStreamMap };\n};\n","import React, { useState } from \"react\";\n\nimport \"./RegionEditor.css\";\nimport { getRoomState } from \"../states/roomMap\";\nimport { ROOM_STATE_KEY, RegionData } from \"../hooks/useGatherArea\";\n\nexport const RegionEditor = React.memo<{\n  roomId: string;\n  userId: string;\n}>(({ roomId, userId }) => {\n  const [regionId, setRegionId] = useState(\"\");\n  const [type, setType] = useState<RegionData[\"type\"]>(\"background\");\n  const [left, setLeft] = useState(100);\n  const [top, setTop] = useState(100);\n  const [width, setWidth] = useState(100);\n  const [height, setHeight] = useState(100);\n  const [zIndex, setZIndex] = useState(0);\n  const [background, setBackground] = useState(\"\");\n  const [border, setBorder] = useState(\"\");\n  const [iframe, setIframe] = useState(\"\");\n\n  const addRegion = () => {\n    const data: RegionData = {\n      type,\n      position: [left, top],\n      size: [width, height],\n      zIndex,\n      background,\n      border,\n      iframe,\n    };\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n    map.set(regionId, data);\n  };\n\n  const [allRegionData, setAllRegionData] = useState<string | null>(null);\n\n  const loadAllRegionData = () => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n    setAllRegionData(JSON.stringify(map.toJSON()));\n  };\n\n  const saveAllRegionData = () => {\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n    try {\n      Object.entries(JSON.parse(allRegionData || \"\")).forEach(\n        ([key, value]) => {\n          map.set(key, value);\n        }\n      );\n      setAllRegionData(null);\n    } catch (e) {\n      console.log(\"failed to save all region data\", e);\n    }\n  };\n\n  const existingRegionIds = [\n    ...getRoomState(roomId, userId).ydoc.getMap(ROOM_STATE_KEY).keys(),\n  ];\n  const loadRegionData = (id: string) => {\n    setRegionId(id);\n    if (!id) return;\n    const roomState = getRoomState(roomId, userId);\n    const map = roomState.ydoc.getMap(ROOM_STATE_KEY);\n    const value = map.get(id);\n    setType(value.type);\n    setLeft(value.position[0]);\n    setTop(value.position[1]);\n    setWidth(value.size[0]);\n    setHeight(value.size[1]);\n    setZIndex(value.zIndex);\n    setBackground(value.background);\n    setBorder(value.border);\n    setIframe(value.iframe);\n  };\n\n  return (\n    <div className=\"RegionEditor-container\">\n      <h3>Region Editor</h3>\n      <label>\n        Region ID:{\" \"}\n        <input value={regionId} onChange={(e) => setRegionId(e.target.value)} />\n      </label>\n      <select\n        onChange={(e) => {\n          loadRegionData(e.target.value);\n        }}\n      >\n        <option value=\"\">(Select to load existing region)</option>\n        {existingRegionIds.map((id) => (\n          <option key={id} value={id}>\n            {id}\n          </option>\n        ))}\n      </select>\n      <hr />\n      <label>\n        Type:{\" \"}\n        <select\n          value={type}\n          onChange={(e) => setType(e.target.value as RegionData[\"type\"])}\n        >\n          <option value=\"background\">Background</option>\n          <option value=\"meeting\">Meeting</option>\n          <option value=\"chat\">Chat</option>\n          <option value=\"media\">Media</option>\n          <option value=\"goboard\">Go Board</option>\n        </select>\n      </label>\n      <hr />\n      <label>\n        Left:{\" \"}\n        <input\n          type=\"number\"\n          value={left}\n          onChange={(e) => setLeft(Number(e.target.value))}\n        />\n      </label>\n      <label>\n        Top:{\" \"}\n        <input\n          type=\"number\"\n          value={top}\n          onChange={(e) => setTop(Number(e.target.value))}\n        />\n      </label>\n      <hr />\n      <label>\n        Width:{\" \"}\n        <input\n          type=\"number\"\n          value={width}\n          onChange={(e) => setWidth(Number(e.target.value))}\n        />\n      </label>\n      <label>\n        Height:{\" \"}\n        <input\n          type=\"number\"\n          value={height}\n          onChange={(e) => setHeight(Number(e.target.value))}\n        />\n      </label>\n      <hr />\n      {type !== \"chat\" && (\n        <label>\n          zIndex:{\" \"}\n          <input\n            type=\"number\"\n            value={zIndex}\n            max={0}\n            onChange={(e) => setZIndex(Number(e.target.value))}\n          />\n        </label>\n      )}\n      <hr />\n      <label>\n        Background:{\" \"}\n        <input\n          value={background}\n          onChange={(e) => setBackground(e.target.value)}\n        />\n      </label>\n      <label>\n        Border:{\" \"}\n        <input value={border} onChange={(e) => setBorder(e.target.value)} />\n      </label>\n      <hr />\n      <label>\n        Iframe:{\" \"}\n        <input value={iframe} onChange={(e) => setIframe(e.target.value)} />\n      </label>\n      <hr />\n      <button type=\"button\" onClick={() => addRegion()} disabled={!regionId}>\n        Add/Update Region\n      </button>\n      <hr />\n      <button\n        type=\"button\"\n        className=\"RegionEditor-toggle\"\n        onClick={() => {\n          if (allRegionData) {\n            setAllRegionData(null);\n          } else {\n            loadAllRegionData();\n          }\n        }}\n      >\n        Import/Export {allRegionData ? <>&#9660;</> : <>&#9654;</>}\n      </button>\n      {!!allRegionData && (\n        <div>\n          <label>\n            All Region Data:{\" \"}\n            <textarea\n              value={allRegionData}\n              onChange={(e) => setAllRegionData(e.target.value)}\n            />\n          </label>\n          <button type=\"button\" onClick={saveAllRegionData}>\n            Replace (Be careful)\n          </button>\n        </div>\n      )}\n    </div>\n  );\n});\n","import React, { useState } from \"react\";\nimport { setConfigAvatar } from \"../states/singleRoom\";\n\nexport const MySetting = React.memo<{\n  statusMesg: string;\n  suspended: boolean;\n  toggleSuspended: () => void;\n  setStatusMesg: (message: string) => void;\n}>(({ statusMesg, suspended, toggleSuspended, setStatusMesg }) => {\n  const [message, setMessage] = useState(statusMesg);\n  const [camera, setCamera] = useState(!suspended);\n  const [avatar, setAvatar] = useState(\"\");\n  const onChangeAvatar = (files: FileList | null) => {\n    const file = files && files[0];\n    if (!file) {\n      return;\n    }\n    if (file.size > 16 * 1024) {\n      // eslint-disable-next-line no-alert\n      window.alert(`Too large: ${file.size}`);\n      return;\n    }\n    const reader = new FileReader();\n    reader.onload = () => {\n      if (typeof reader.result === \"string\") {\n        setAvatar(reader.result);\n      }\n    };\n    reader.readAsDataURL(file);\n  };\n\n  return (\n    <div className=\"RegionEditor-container\">\n      <h3>Setting</h3>\n      <label>\n        Camera :{\" \"}\n        <button\n          type=\"button\"\n          onClick={() => {\n            setCamera(!camera);\n          }}\n        >\n          {camera ? \"on\" : \"off\"}\n        </button>\n      </label>\n      <hr />\n      {!camera && (\n        <>\n          <label>\n            Avatar:{\" \"}\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={(e) => onChangeAvatar(e.target.files)}\n            />\n          </label>\n          <hr />\n        </>\n      )}\n      <label>\n        Message:{\" \"}\n        <input\n          type=\"text\"\n          defaultValue={message || \"\"}\n          onChange={(e) => {\n            setMessage(e.target.value);\n          }}\n        />\n      </label>\n      <hr />\n      <button\n        type=\"button\"\n        onClick={() => {\n          if (message !== null) {\n            setStatusMesg(message);\n          }\n          if (suspended === camera) {\n            toggleSuspended();\n          }\n          if (suspended && avatar) {\n            setConfigAvatar(avatar);\n          }\n        }}\n      >\n        update\n      </button>\n    </div>\n  );\n});\n","import { ROOM_ID_PREFIX_LEN } from \"../network/room\";\nimport { importCryptoKey } from \"./crypto\";\n\nexport const generateExcalidrawURL = async (roomId: string) => {\n  const id = roomId.slice(0, 20);\n  const imported = await importCryptoKey(roomId.slice(ROOM_ID_PREFIX_LEN));\n  const key = (await window.crypto.subtle.exportKey(\"jwk\", imported)).k;\n  return `https://excalidraw.com/#room=${id},${key}`;\n};\n","import React, { useEffect, useState } from \"react\";\n\nimport \"./LinkOpener.css\";\nimport { generateExcalidrawURL } from \"../utils/excalidraw\";\n\nexport const LinkOpener = React.memo<{\n  roomId: string;\n}>(({ roomId }) => {\n  const [excalidrawUrl, setExcalidrawUrl] = useState<string>();\n  useEffect(() => {\n    (async () => {\n      setExcalidrawUrl(await generateExcalidrawURL(roomId));\n    })();\n  }, [roomId]);\n\n  const appLink = `remote-faces://${window.location.href.replace(\n    /^https:\\/\\//,\n    \"\"\n  )}`;\n\n  return (\n    <div className=\"LinkOpener-container\">\n      <div>\n        <span title=\"Share this link with your colleagues\">Room Link: </span>\n        <input value={window.location.href} readOnly />\n      </div>\n      <div>\n        <a href={appLink} title=\"Open this link in the desktop app\">\n          Open App\n        </a>\n      </div>\n      <div>\n        <a href={excalidrawUrl} target=\"_blank\" rel=\"noreferrer\">\n          Open Excalidraw\n        </a>\n      </div>\n    </div>\n  );\n});\n","import React from \"react\";\n\nimport \"./Loading.css\";\n\nexport const Loading = React.memo(() => (\n  <div className=\"Loading-container\">\n    <div className=\"loader\">\n      <div>Loading...</div>\n    </div>\n  </div>\n));\n","import React from \"react\";\n\nimport \"./FaceCard.css\";\nimport { useFaceImageObsoleted } from \"../hooks/useFaceImages\";\nimport { BLANK_IMAGE } from \"../media/imagePresets\";\nimport { isEmoji } from \"../utils/emoji\";\n\nexport const FaceCard = React.memo<{\n  image?: string;\n  nickname: string;\n  statusMesg: string;\n  setStatusMesg?: (mesg: string) => void;\n  updated?: number; // in milliseconds\n  inFaceList?: boolean;\n  liveMode?: boolean;\n  stream?: MediaStream;\n  muted: boolean;\n  micOn: boolean;\n  speakerOn: boolean;\n}>(\n  ({\n    image,\n    nickname,\n    statusMesg,\n    setStatusMesg,\n    updated,\n    inFaceList,\n    liveMode,\n    stream,\n    muted,\n    micOn,\n    speakerOn,\n  }) => {\n    const obsoleted = useFaceImageObsoleted(updated);\n    const updatedDate = updated && new Date(updated);\n    const firstStatusMesgChar: string | undefined = [...statusMesg][0];\n    let emoji = setStatusMesg ? String.fromCodePoint(0x1f4dd) : \"\";\n    if (firstStatusMesgChar) {\n      if (isEmoji(firstStatusMesgChar)) {\n        emoji = firstStatusMesgChar;\n      } else {\n        emoji = String.fromCodePoint(0x1f4ac);\n      }\n    }\n    const editStatusMesg = () => {\n      if (setStatusMesg) {\n        // eslint-disable-next-line no-alert\n        const mesg = window.prompt(\"Enter status message\");\n        if (mesg !== null) {\n          setStatusMesg(mesg);\n        }\n      }\n    };\n    return (\n      <div\n        className=\"FaceCard-container\"\n        style={{ opacity: obsoleted ? 0.2 : 1 }}\n      >\n        {liveMode && stream ? (\n          <video\n            className=\"FaceCard-photo\"\n            ref={(videoEle) => {\n              if (videoEle && videoEle.srcObject !== stream) {\n                // eslint-disable-next-line no-param-reassign\n                videoEle.srcObject = stream;\n              }\n            }}\n            autoPlay\n            playsInline\n            muted={muted}\n          />\n        ) : (\n          <img\n            src={image || BLANK_IMAGE}\n            className=\"FaceCard-photo\"\n            alt=\"faceImage\"\n          />\n        )}\n        <div className=\"FaceCard-name\">{nickname}</div>\n        {inFaceList && setStatusMesg && (\n          <button\n            type=\"button\"\n            className=\"FaceCard-mesg\"\n            title={statusMesg || \"(No status message)\"}\n            onClick={editStatusMesg}\n          >\n            {emoji}\n          </button>\n        )}\n        {inFaceList && !setStatusMesg && (\n          <div\n            className=\"FaceCard-mesg\"\n            title={statusMesg || \"(No status message)\"}\n          >\n            {emoji}\n          </div>\n        )}\n        {inFaceList && updatedDate && (\n          <div className=\"FaceCard-updated\">\n            <span title={updatedDate.toLocaleString()}>\n              {`${updatedDate.getHours()}`.padStart(2, \"0\")}:\n              {`${updatedDate.getMinutes()}`.padStart(2, \"0\")}\n            </span>\n          </div>\n        )}\n        {!inFaceList && liveMode && stream && (\n          <div className=\"FaceCard-mic-speaker-icons\">\n            {micOn && <span title=\"Mic On\">&#x1F3A4;</span>}\n            {speakerOn && <span title=\"Speaker On\">&#x1F508;</span>}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n","import React from \"react\";\nimport { useSnapshot } from \"valtio\";\n\nimport \"./FaceList.css\";\nimport { Loading } from \"./Loading\";\nimport { useFaceImages } from \"../hooks/useFaceImages\";\nimport { FaceCard } from \"./FaceCard\";\nimport { NG_IMAGE } from \"../media/imagePresets\";\n\n// XXX temporary global state for debugging\nimport { getRoomState } from \"../states/roomMap\";\n\nexport const FaceList = React.memo<{\n  roomId: string;\n  userId: string;\n  avatar: string;\n  nickname: string;\n  statusMesg: string;\n  setStatusMesg: (mesg: string) => void;\n  videoDeviceId?: string;\n  suspended: boolean;\n}>(\n  ({\n    roomId,\n    userId,\n    avatar,\n    nickname,\n    statusMesg,\n    setStatusMesg,\n    videoDeviceId,\n    suspended,\n  }) => {\n    const userIdMap = useSnapshot(getRoomState(roomId, userId).userIdMap);\n    const { myImage, roomImages } = useFaceImages(\n      roomId,\n      userId,\n      avatar,\n      nickname,\n      statusMesg,\n      suspended,\n      false,\n      false,\n      false,\n      videoDeviceId\n    );\n    return (\n      <div className=\"FaceList-list\">\n        <div className=\"FaceList-item\">\n          <FaceCard\n            image={myImage}\n            nickname={nickname}\n            statusMesg={statusMesg}\n            setStatusMesg={setStatusMesg}\n            inFaceList\n            muted\n            micOn={false}\n            speakerOn={false}\n          />\n        </div>\n        {roomImages.map((item) => (\n          <div key={item.userId} className=\"FaceList-item\">\n            <FaceCard\n              image={\n                typeof userIdMap[item.userId] === \"number\"\n                  ? item.image\n                  : NG_IMAGE\n              }\n              nickname={item.info.nickname}\n              statusMesg={item.info.message}\n              updated={item.updated}\n              inFaceList\n              muted\n              micOn={false}\n              speakerOn={false}\n            />\n          </div>\n        ))}\n        {!roomImages.length && (\n          <div className=\"FaceList-item\">\n            <Loading />\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n","/* eslint jsx-a11y/no-static-element-interactions: off */\n\nimport React, { Suspense, useCallback, useRef, useState } from \"react\";\n\nimport \"./GatherArea.css\";\nimport {\n  useGatherArea,\n  RegionData,\n  RegionMap,\n  AvatarData,\n} from \"../hooks/useGatherArea\";\nimport { useFaceImages, useFaceImageObsoleted } from \"../hooks/useFaceImages\";\nimport { useFaceVideos } from \"../hooks/useFaceVideos\";\nimport { RegionEditor } from \"./RegionEditor\";\nimport { MySetting } from \"./MySetting\";\nimport { LinkOpener } from \"./LinkOpener\";\nimport { FaceList } from \"./FaceList\";\nimport { FaceCard } from \"./FaceCard\";\nimport { SuspenseFallback } from \"./SuspenseFallback\";\n\nconst MomentaryChat = React.lazy(() => import(\"./MomentaryChat\"));\nconst MediaShare = React.lazy(() => import(\"./MediaShare\"));\nconst GoBoard = React.lazy(() => import(\"./GoBoard\"));\n\ntype OnMouseMove = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n\nconst getActiveMeetingRegionId = (avatar: AvatarData, regionMap: RegionMap) => {\n  const regionIdList = Object.keys(regionMap).sort(\n    (a, b) => (regionMap[b].zIndex ?? 0) - (regionMap[a].zIndex ?? 0)\n  );\n  const activeId = regionIdList.find((id) => {\n    const { type, position, size } = regionMap[id] as RegionData;\n    return (\n      type === \"meeting\" &&\n      position[0] <= avatar.position[0] + 36 &&\n      position[1] <= avatar.position[1] + 36 &&\n      avatar.position[0] <= position[0] + size[0] &&\n      avatar.position[1] <= position[1] + size[1]\n    );\n  });\n  return activeId;\n};\n\nconst getMicOn = (avatar: AvatarData, regionMap: RegionMap, id?: string) => {\n  if (!id) return undefined;\n  const { position, size } = regionMap[id];\n  const micOn =\n    position[0] <= avatar.position[0] &&\n    position[1] <= avatar.position[1] &&\n    avatar.position[0] + 36 <= position[0] + size[0] &&\n    avatar.position[1] + 36 <= position[1] + size[1];\n  return micOn;\n};\n\nconst Region = React.memo<{\n  roomId: string;\n  userId: string;\n  nickname: string;\n  id: string;\n  data: RegionData;\n  highlight?: \"meeting\" | \"active-meeting\" | \"micon-meeting\";\n  setPosition?: (nextPosition: [number, number]) => void;\n  registerOnMouseDrag: (onMouseMove?: OnMouseMove) => void;\n}>(\n  ({\n    roomId,\n    userId,\n    nickname,\n    id,\n    data,\n    highlight,\n    setPosition,\n    registerOnMouseDrag,\n  }) => {\n    let boxShadow: string | undefined;\n    if (highlight === \"micon-meeting\") {\n      boxShadow = \"0 0 0 5px rgba(255, 0, 0, 0.6)\";\n    } else if (highlight === \"active-meeting\") {\n      boxShadow = \"0 0 0 3px rgba(255, 0, 0, 0.3)\";\n    } else if (highlight === \"meeting\") {\n      boxShadow = \"0 0 0 1px rgba(255, 0, 0, 0.3)\";\n    }\n    return (\n      <div\n        className=\"GatherArea-region\"\n        style={{\n          left: `${data.position[0]}px`,\n          top: `${data.position[1]}px`,\n          width: `${data.size[0]}px`,\n          height: `${data.size[1]}px`,\n          boxShadow,\n          zIndex: data.type !== \"chat\" ? data.zIndex : undefined,\n          background: data.background,\n          border: data.border,\n        }}\n        onMouseDown={(e) => {\n          if (data.type !== \"background\") {\n            return;\n          }\n          e.preventDefault();\n          if (setPosition) {\n            const target = e.currentTarget;\n            const offset = [\n              e.clientX - data.position[0],\n              e.clientY - data.position[1],\n            ];\n            registerOnMouseDrag((e) => {\n              const left = e.clientX - offset[0];\n              const top = e.clientY - offset[1];\n              target.style.left = `${left}px`;\n              target.style.top = `${top}px`;\n              setPosition([left, top]);\n            });\n          }\n        }}\n      >\n        {data.iframe && <iframe title={id} src={data.iframe} frameBorder=\"0\" />}\n        {data.type === \"chat\" && (\n          <Suspense fallback={<SuspenseFallback />}>\n            <MomentaryChat\n              roomId={roomId}\n              userId={userId}\n              nickname={nickname}\n              uniqueId={id}\n            />\n          </Suspense>\n        )}\n        {data.type === \"media\" && (\n          <Suspense fallback={<SuspenseFallback />}>\n            <MediaShare\n              roomId={roomId}\n              userId={userId}\n              nickname={nickname}\n              uniqueId={id}\n            />\n          </Suspense>\n        )}\n        {data.type === \"goboard\" && (\n          <Suspense fallback={<SuspenseFallback />}>\n            <GoBoard roomId={roomId} userId={userId} uniqueId={id} />\n          </Suspense>\n        )}\n      </div>\n    );\n  }\n);\n\nconst Avatar = React.memo<{\n  nickname: string;\n  statusMesg: string;\n  setStatusMesg?: (mesg: string) => void;\n  image?: string;\n  updated?: number; // in milliseconds\n  position: [left: number, top: number];\n  setPosition?: (nextPosition: [number, number]) => void;\n  registerOnMouseDrag: (onMouseMove?: OnMouseMove) => void;\n  stream?: MediaStream;\n  liveMode: boolean;\n  muted?: boolean;\n  micOn?: boolean;\n}>(\n  ({\n    nickname,\n    statusMesg,\n    setStatusMesg,\n    image,\n    updated,\n    position,\n    setPosition,\n    registerOnMouseDrag,\n    stream,\n    liveMode,\n    muted,\n    micOn,\n  }) => {\n    const obsoleted = useFaceImageObsoleted(updated);\n    return (\n      <div\n        className=\"GatherArea-avatar\"\n        style={{\n          left: `${position[0]}px`,\n          top: `${position[1]}px`,\n        }}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          if (setPosition) {\n            const target = e.currentTarget;\n            const offset = [e.clientX - position[0], e.clientY - position[1]];\n            registerOnMouseDrag((e) => {\n              const left = e.clientX - offset[0];\n              const top = e.clientY - offset[1];\n              target.style.left = `${left}px`;\n              target.style.top = `${top}px`;\n              setPosition([left, top]);\n            });\n          }\n        }}\n      >\n        {statusMesg && (\n          <div\n            className=\"GatherArea-avatar-balloon\"\n            style={{ opacity: obsoleted ? 0.2 : 1 }}\n          >\n            {statusMesg}\n          </div>\n        )}\n        <FaceCard\n          image={image}\n          nickname={nickname}\n          statusMesg={statusMesg}\n          setStatusMesg={setStatusMesg}\n          updated={updated}\n          liveMode={liveMode}\n          stream={stream}\n          muted={!!muted}\n          micOn={!!micOn}\n          speakerOn={liveMode}\n        />\n      </div>\n    );\n  }\n);\n\nexport const GatherArea = React.memo<{\n  roomId: string;\n  userId: string;\n  avatar: string;\n  nickname: string;\n  statusMesg: string;\n  setStatusMesg: (mesg: string) => void;\n  videoDeviceId?: string;\n  audioDeviceId?: string;\n  toggleSuspended: () => void;\n  suspended: boolean;\n}>(\n  ({\n    roomId,\n    userId,\n    avatar,\n    nickname,\n    statusMesg,\n    setStatusMesg,\n    videoDeviceId,\n    audioDeviceId,\n    toggleSuspended,\n    suspended,\n  }) => {\n    const { myImage, roomImages } = useFaceImages(\n      roomId,\n      userId,\n      avatar,\n      nickname,\n      statusMesg,\n      suspended,\n      false,\n      false,\n      false,\n      videoDeviceId\n    );\n    const {\n      avatarMap,\n      myAvatar,\n      setMyAvatar,\n      regionMap,\n      updateRegion,\n    } = useGatherArea(roomId, userId);\n\n    const onMouseDragRef = useRef<OnMouseMove>();\n    const registerOnMouseDrag = useCallback((onMouseMove?: OnMouseMove) => {\n      onMouseDragRef.current = onMouseMove;\n    }, []);\n\n    const activeMeetingRegionId = getActiveMeetingRegionId(myAvatar, regionMap);\n    const activeMeetingMicOn = getMicOn(\n      myAvatar,\n      regionMap,\n      activeMeetingRegionId\n    );\n\n    const { faceStream, faceStreamMap } = useFaceVideos(\n      roomId,\n      userId,\n      !!activeMeetingRegionId,\n      !!activeMeetingRegionId,\n      !!activeMeetingMicOn,\n      videoDeviceId,\n      audioDeviceId,\n      `gatherArea/meeting/${activeMeetingRegionId}/`\n    );\n\n    const [showModal, setShowModal] = useState<\n      null | \"region-editor\" | \"link-opener\" | \"setting\"\n    >(null);\n\n    return (\n      <div className=\"GatherArea-container\">\n        <div\n          className=\"GatherArea-body\"\n          onMouseMove={(e) => {\n            if (onMouseDragRef.current) {\n              onMouseDragRef.current(e);\n            }\n          }}\n          onMouseUp={() => {\n            registerOnMouseDrag();\n          }}\n        >\n          {Object.entries(regionMap).map(([regionId, regionData]) => (\n            <Region\n              key={regionId}\n              roomId={roomId}\n              userId={userId}\n              nickname={nickname}\n              id={regionId}\n              data={regionData}\n              highlight={\n                (regionId === activeMeetingRegionId &&\n                  (activeMeetingMicOn ? \"micon-meeting\" : \"active-meeting\")) ||\n                (regionData.type === \"meeting\" ? \"meeting\" : undefined)\n              }\n              setPosition={(position) =>\n                updateRegion(regionId, { ...regionData, position })\n              }\n              registerOnMouseDrag={registerOnMouseDrag}\n            />\n          ))}\n          {Object.entries(avatarMap).map(([uid, avatarData]) => {\n            if (uid === userId) {\n              return null;\n            }\n            const imageData = roomImages.find((data) => data.userId === uid);\n            if (!imageData) {\n              return null;\n            }\n            return (\n              <Avatar\n                key={uid}\n                nickname={imageData.info.nickname}\n                statusMesg={imageData.info.message}\n                image={imageData.image}\n                updated={imageData.updated}\n                position={avatarData.position}\n                registerOnMouseDrag={registerOnMouseDrag}\n                stream={faceStreamMap[uid]}\n                liveMode={!!activeMeetingRegionId}\n                micOn={getMicOn(avatarData, regionMap, activeMeetingRegionId)}\n              />\n            );\n          })}\n          <Avatar\n            nickname={nickname}\n            statusMesg={statusMesg}\n            setStatusMesg={setStatusMesg}\n            image={myImage}\n            position={myAvatar.position}\n            setPosition={(position) =>\n              setMyAvatar((prev) => ({ ...prev, position }))\n            }\n            registerOnMouseDrag={registerOnMouseDrag}\n            stream={faceStream || undefined}\n            liveMode={!!activeMeetingRegionId}\n            muted\n            micOn={activeMeetingMicOn}\n          />\n        </div>\n        <div className=\"GatherArea-facelist\">\n          <FaceList\n            roomId={roomId}\n            userId={userId}\n            avatar={avatar}\n            nickname={nickname}\n            statusMesg={statusMesg}\n            setStatusMesg={setStatusMesg}\n            videoDeviceId={videoDeviceId}\n            suspended={suspended}\n          />\n        </div>\n        <div className=\"GatherArea-toolbar\">\n          <div>\n            <button\n              type=\"button\"\n              onClick={() =>\n                setShowModal(showModal === \"setting\" ? null : \"setting\")\n              }\n            >\n              {showModal === \"setting\" ? \"Close Setting\" : \"Open Setting\"}\n            </button>\n            {showModal === \"setting\" && (\n              <div className=\"GatherArea-setting\">\n                <MySetting\n                  statusMesg={statusMesg}\n                  suspended={suspended}\n                  toggleSuspended={toggleSuspended}\n                  setStatusMesg={setStatusMesg}\n                />\n              </div>\n            )}\n          </div>\n          <div>\n            <button\n              type=\"button\"\n              onClick={() =>\n                setShowModal(\n                  showModal === \"region-editor\" ? null : \"region-editor\"\n                )\n              }\n            >\n              {showModal === \"region-editor\"\n                ? \"Close Region Editor\"\n                : \"Open Region Editor\"}\n            </button>\n            {showModal === \"region-editor\" && (\n              <div className=\"GatherArea-region-editor\">\n                <RegionEditor roomId={roomId} userId={userId} />\n              </div>\n            )}\n          </div>\n          <div>\n            <button\n              type=\"button\"\n              onClick={() =>\n                setShowModal(showModal === \"link-opener\" ? null : \"link-opener\")\n              }\n            >\n              {showModal === \"link-opener\"\n                ? \"Close Link Opener\"\n                : \"Open Link Opener\"}\n            </button>\n            {showModal === \"link-opener\" && (\n              <div className=\"GatherArea-link-opener\">\n                <LinkOpener roomId={roomId} />\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n);\n\nexport default GatherArea;\n","import React, { useEffect, useState } from \"react\";\nimport { useSnapshot } from \"valtio\";\n\nimport \"./SingleRoom.css\";\nimport { singleRoomState, toggleConfigTakePhoto } from \"../states/singleRoom\";\nimport { setRoomIdToUrl } from \"../utils/url\";\nimport { GatherArea } from \"./GatherArea\";\n\nexport const SingleRoom = React.memo(() => {\n  const { roomId, userId, config } = useSnapshot(singleRoomState);\n  const [statusMesg, setStatusMesg] = useState(\"\");\n  useEffect(() => {\n    setRoomIdToUrl(roomId);\n  }, [roomId]);\n\n  return (\n    <div className=\"SingleRoom-container\">\n      <GatherArea\n        roomId={roomId}\n        userId={userId}\n        avatar={config.avatar}\n        nickname={config.nickname}\n        statusMesg={statusMesg}\n        setStatusMesg={setStatusMesg}\n        suspended={!config.takePhoto}\n        videoDeviceId={config.videoDeviceId}\n        audioDeviceId={config.audioDeviceId}\n        toggleSuspended={toggleConfigTakePhoto}\n      />\n    </div>\n  );\n});\n\nexport default SingleRoom;\n","export const getVideoStream = async (deviceId?: string) => {\n  const constraints = deviceId\n    ? {\n        video: { deviceId },\n      }\n    : { video: true };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const dispose = () => {\n    track.stop();\n  };\n  return {\n    stream,\n    dispose,\n  };\n};\n\nexport const getFaceVideoStream = async (deviceId?: string) => {\n  const constraints = {\n    video: {\n      deviceId,\n      frameRate: { max: 5 },\n      width: { exact: 72 },\n      height: { exact: 72 },\n    },\n  };\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  const [track] = stream.getVideoTracks();\n  const dispose = () => {\n    track.stop();\n  };\n  return {\n    stream,\n    dispose,\n  };\n};\n","import React from \"react\";\nimport \"emoji-mart/css/emoji-mart.css\";\nimport { BaseEmoji, Picker, getEmojiDataFromNative, Data } from \"emoji-mart\";\nimport data from \"emoji-mart/data/all.json\";\n\nexport { Emoji } from \"emoji-mart\";\nexport type EmojiDataType = BaseEmoji;\n\n// we do not support custom emojis\nexport const EmojiPicker = Picker as React.ComponentType<\n  | Omit<React.ComponentProps<typeof Picker>, \"custom\" | \"onSelect\">\n  | {\n      onSelect: (emoji: BaseEmoji) => void;\n    }\n>;\n\nexport const isEmoji = (s: string) => {\n  const emojiData: BaseEmoji | null = getEmojiDataFromNative(\n    s,\n    \"apple\",\n    (data as unknown) as Data\n  );\n  return !!emojiData;\n};\n"],"sourceRoot":""}