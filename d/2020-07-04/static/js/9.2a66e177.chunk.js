(this["webpackJsonpremote-faces-web"]=this["webpackJsonpremote-faces-web"]||[]).push([[9],{106:function(e,t,n){"use strict";n.r(t),n.d(t,"VideoShare",(function(){return p}));var r=n(3),a=n(0),c=n.n(a),u=(n(97),n(39)),i=n(37),o=n(1),s=n.n(o),l=n(2),f=n(43),d=n(34),m=function(){var e=Object(l.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"===t.kind){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,Object(f.c)(t);case 4:return n=e.sent,e.abrupt("return",!n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=n(61),v=n(42),j=c.a.memo((function(e){var t=e.nickname,n=e.stream,r=Object(a.useRef)(null);return Object(a.useEffect)((function(){n&&r.current&&(r.current.srcObject=n)}),[n]),c.a.createElement("div",null,c.a.createElement("div",{className:"VideoShare-nickname"},t),c.a.createElement("video",{className:"VideoShare-video",ref:r,autoPlay:!0,muted:!0}))})),p=c.a.memo((function(e){var t=e.roomId,n=e.userId,o=e.nickname,p=Object(b.b)(),O=Object(a.useState)(),h=Object(r.a)(O,2),k=h[0],E=h[1],S=Object(a.useState)(!1),w=Object(r.a)(S,2),y=w[0],x=w[1],V=function(e,t,n,c,o){var b=Object(a.useState)(null),v=Object(r.a)(b,2),j=v[0],p=v[1],O=Object(a.useState)({}),h=Object(r.a)(O,2),k=h[0],E=h[1],S=Object(a.useRef)([]);Object(a.useEffect)((function(){return function(){S.current.forEach((function(e){return e()}))}}),[]);var w=Object(a.useCallback)(function(){var e=Object(l.a)(s.a.mark((function e(t,n){var r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(t);case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:E((function(e){return Object(i.a)(Object(i.a)({},e),{},Object(u.a)({},n.userId,new MediaStream([t])))})),r=function(){E((function(e){return Object(i.a)(Object(i.a)({},e),{},Object(u.a)({},n.userId,null))}))},t.addEventListener("ended",r),S.current.push((function(){t.removeEventListener("ended",r)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),y=Object(d.c)(e,t,w,"cameraVideo"),x=y.addTrack,V=y.removeTrack;return Object(a.useEffect)((function(){var e=null;return n&&x&&V&&Object(l.a)(s.a.mark((function t(){var n,a,u,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(f.b)(o);case 2:n=t.sent,a=n.stream.getVideoTracks(),u=Object(r.a)(a,1),i=u[0],x(i),p(n.stream),e=function(){V(i),n.dispose(),p(null),c(!1)},i.addEventListener("ended",(function(){e&&e(),e=null}));case 8:case"end":return t.stop()}}),t)})))(),function(){e&&e()}}),[e,o,n,c,x,V]),{videoStream:j,videoStreamMap:k}}(t,n,y,x,k),I=V.videoStream,N=V.videoStreamMap,g=Object(v.a)(t,n),C=(I?1:0)+Object.values(N).filter((function(e){return e})).length;return c.a.createElement("div",{className:"VideoShare-container"},c.a.createElement("div",null,"Select Camera:"," ",c.a.createElement("select",{value:k,onChange:function(e){return E(e.target.value)}},p.map((function(e){return c.a.createElement("option",{key:e.deviceId,value:e.deviceId},e.label)})))),c.a.createElement("button",{type:"button",onClick:function(){return x(!y)}},y?"Stop video share":"Start video share"),c.a.createElement("div",{className:"VideoShare-body",style:{gridTemplateColumns:"repeat(".concat(Math.ceil(Math.sqrt(C)),", 1fr)")}},I&&c.a.createElement(j,{nickname:o,stream:I}),Object.keys(N).map((function(e){var t=N[e];return t?c.a.createElement(j,{key:e,nickname:g[e]||"No Name",stream:t}):null}))))}));t.default=p},97:function(e,t,n){}}]);
//# sourceMappingURL=9.2a66e177.chunk.js.map