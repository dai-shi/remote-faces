"use strict";(self.webpackChunkremote_faces_web=self.webpackChunkremote_faces_web||[]).push([[98],{82098:(e,t,n)=>{n.r(t),n.d(t,{MediaShare:()=>v,default:()=>f});var a=n(56167),r=n(14726);var s=n(7232),c=n(23463);const i=(e,t,n,i,l)=>{const o=`${l||"mediaShare"}Video`,[d,u]=(0,a.useState)(null),[m,h]=(0,a.useState)({}),v=(0,a.useRef)([]);(0,a.useEffect)((()=>()=>{v.current.forEach((e=>e()))}),[]);const f=(0,r.RK)((0,c.V)(e,t).trackMap);return Object.entries(f[o]||{}).forEach((e=>{var t;let[n,a]=e;if("ended"===a.readyState)return;if(null!==(t=m[n])&&void 0!==t&&t.getTracks().includes(a))return;h((e=>({...e,[n]:new MediaStream([a])})));const r=()=>{h((e=>({...e,[n]:null})))};a.addEventListener("ended",r),v.current.push((()=>{a.removeEventListener("ended",r)}))})),(0,a.useEffect)((()=>{const n=(0,c.V)(e,t);return n.addMediaType(o),()=>{n.removeMediaType(o)}}),[e,t,o]),(0,a.useEffect)((()=>{const a=(0,c.V)(e,t);let r=null;return n&&(async()=>{let e;if("SCREEN"===n){const t=await(async()=>{try{const e={video:!0},t=await navigator.mediaDevices.getDisplayMedia(e),[n]=t.getVideoTracks();return{stream:t,dispose:()=>{n.stop()}}}catch(e){return null}})();if(!t)return void i();e=t}else e=await(0,s.a)(n.video);const[t]=e.stream.getVideoTracks();a.addTrack(o,t),u(e.stream),t.addEventListener("ended",(()=>{r&&r(),r=null}));const c=()=>{a.removeTrack(o),e.dispose(),u(null),i()};!1===r?c():r=c})(),()=>{r&&r(),r=!1}}),[e,t,o,n,i]),{videoStream:d,videoStreamMap:m}};var l=n(54835),o=n(30702),d=n(50634);const u=(e,t)=>{const[n,r]=(0,a.useState)({});return(0,a.useEffect)((()=>{const n=(0,c.V)(e,t);return(0,o.Ld)(n.faceImages,(()=>{r((e=>{const a={...e};let r=!1;return Object.entries(n.faceImages).forEach((e=>{let[n,s]=e;var c;n!==t&&(c=s,(0,d.Kn)(c)&&(0,d.Kn)(c.info)&&"string"===typeof c.info.nickname&&(a[n]?s.info.nickname!==a[n]&&(a[n]=s.info.nickname,r=!0):(a[n]=s.info.nickname,r=!0)))})),r?a:e}))}))}),[e,t]),n};var m=n(37878);const h=(0,a.memo)((e=>{let{nickname:t,stream:n}=e;const r=(0,a.useRef)(null);return(0,a.useEffect)((()=>{n&&r.current&&(r.current.srcObject=n)}),[n]),(0,m.jsxs)("div",{className:"MediaShare-card",children:[(0,m.jsx)("video",{className:"MediaShare-video",ref:r,autoPlay:!0,muted:!0}),(0,m.jsx)("div",{className:"MediaShare-nickname",children:t})]})})),v=(0,a.memo)((e=>{let{roomId:t,userId:n,nickname:r,uniqueId:s}=e;const c=(0,l.k)(),[o,d]=(0,a.useState)(""),[v,f]=(0,a.useState)(null),p=(0,a.useCallback)((()=>{f(null)}),[]),{videoStream:S,videoStreamMap:k}=i(t,n,v,p,s),j=u(t,n),[y,b]=(0,a.useState)("grid"),g=(S?1:0)+Object.values(k).filter((e=>e)).length,x=Math.ceil(Math.sqrt(g)),E=Math.ceil(g/x),M="grid"===y?{gridTemplateColumns:`repeat(${x}, 1fr)`,gridTemplateRows:`repeat(${E}, ${100/E}%)`}:{gridTemplateRows:Array(g).fill("100%").join(" ")},C=(0,a.useRef)(null),[w,N]=(0,a.useState)(!1);return(0,m.jsxs)("div",{className:"MediaShare-container",ref:C,children:[(0,m.jsxs)("div",{className:"MediaShare-toolbar",children:[!w&&(0,m.jsx)("button",{type:"button",onClick:async()=>{if(C.current)try{await C.current.requestFullscreen(),N(!0),C.current.onfullscreenchange=()=>{N(document.fullscreenElement===C.current)}}catch(e){}},children:"Enter Fullscreen"}),w&&(0,m.jsx)("button",{type:"button",onClick:async()=>{try{document.exitFullscreen(),N(!1)}catch(e){}},children:"Exit Fullscreen"}),(0,m.jsxs)("select",{value:y,onChange:e=>b(e.target.value),children:[(0,m.jsx)("option",{value:"grid",children:"Display in Grid"}),(0,m.jsx)("option",{value:"vertical",children:"Display Vertically"})]}),null!==v&&(0,m.jsx)("button",{type:"button",onClick:p,children:"Stop sharing"}),null===v&&(0,m.jsx)("button",{type:"button",onClick:()=>f("SCREEN"),children:"Start Screen Share"}),null===v&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("select",{value:o,onChange:e=>d(e.target.value),children:[(0,m.jsx)("option",{value:"",disabled:!0,children:"Select Camera to Share"}),c.map((e=>(0,m.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))]}),o&&(0,m.jsx)("button",{type:"button",onClick:()=>f({video:o}),children:"Start Video Share"})]})]}),(0,m.jsxs)("div",{className:"MediaShare-body",style:M,children:[S&&(0,m.jsx)(h,{nickname:r,stream:S}),Object.keys(k).map((e=>{const t=k[e];return t?(0,m.jsx)(h,{nickname:j[e]||"No Name",stream:t},e):null}))]})]})})),f=v}}]);
//# sourceMappingURL=98.c0ff61f0.chunk.js.map