import{r as i,u as y,s as T}from"./index.5ba83cc3.js";import{g as d,a as x,i as E}from"./SingleRoom.8c9b7936.js";const V=async()=>{try{const t={video:!0},n=await navigator.mediaDevices.getDisplayMedia(t),[r]=n.getVideoTracks();return{stream:n,dispose:()=>{r.stop()}}}catch{return null}},O=(t,n,r,p,S)=>{const s=`${S||"mediaShare"}Video`,[f,l]=i.exports.useState(null),[o,u]=i.exports.useState({}),k=i.exports.useRef([]);i.exports.useEffect(()=>()=>{k.current.forEach(e=>e())},[]);const M=([a,e])=>{if(e.readyState==="ended"||o[a]?.getTracks().includes(e))return;u(m=>({...m,[a]:new MediaStream([e])}));const c=()=>{u(m=>({...m,[a]:null}))};e.addEventListener("ended",c),k.current.push(()=>{e.removeEventListener("ended",c)})},h=y(d(t,n).trackMap);return Object.entries(h[s]||{}).forEach(M),i.exports.useEffect(()=>{const a=d(t,n);return a.addMediaType(s),()=>{a.removeMediaType(s)}},[t,n,s]),i.exports.useEffect(()=>{const a=d(t,n);let e=null;return r&&(async()=>{let c;if(r==="SCREEN"){const v=await V();if(!v){p();return}c=v}else c=await x(r.video);const[m]=c.stream.getVideoTracks();a.addTrack(s,m),l(c.stream),m.addEventListener("ended",()=>{e&&e(),e=null});const g=()=>{a.removeTrack(s),c.dispose(),l(null),p()};e===!1?g():e=g})(),()=>{e&&e(),e=!1}},[t,n,s,r,p]),{videoStream:f,videoStreamMap:o}},b=t=>E(t)&&E(t.info)&&typeof t.info.nickname=="string",j=(t,n)=>{const[r,p]=i.exports.useState({});return i.exports.useEffect(()=>{const S=d(t,n);return T(S.faceImages,()=>{p(s=>{const f={...s};let l=!1;return Object.entries(S.faceImages).forEach(([o,u])=>{o!==n&&(!b(u)||(f[o]?u.info.nickname!==f[o]&&(f[o]=u.info.nickname,l=!0):(f[o]=u.info.nickname,l=!0)))}),l?f:s})})},[t,n]),r};export{j as a,O as u};
