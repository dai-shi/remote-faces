import{r as n,l as M,a as p,j as f}from"./index.ddbdddf8.js";import{u as b,a as x}from"./useNicknameMap.035fbe2a.js";import"./SingleRoom.e4202879.js";const S=n.exports.memo(({nickname:s,stream:r})=>{const c=n.exports.useRef(null),o=n.exports.useCallback(()=>{try{c.current?.close()}catch{}},[]);n.exports.useEffect(()=>o,[o]);const i=n.exports.useCallback(()=>{o();const a=M();if(c.current=window.open(`stream_viewer.html#${a}`,"_blank"),!c.current)return;const d=c.current,l=new BroadcastChannel(a),t=new RTCPeerConnection;t.addTrack(r.getVideoTracks()[0],r),t.onicecandidate=e=>{l.postMessage({type:"ice",candidate:e.candidate?.candidate,sdpMid:e.candidate?.sdpMid,sdpMLineIndex:e.candidate?.sdpMLineIndex})},l.onmessage=e=>{if(e.data.type==="ice"){t.addIceCandidate(e.data.candidate?e.data:void 0);return}t.setRemoteDescription(e.data)},d.onload=async()=>{d.document.title=s;const e=await t.createOffer();l.postMessage({type:"offer",sdp:e.sdp}),await t.setLocalDescription(e)}},[s,r,o]);return p("div",{className:"MeetingScreen-opener",children:p("button",{type:"button",onClick:i,children:s})})}),y=n.exports.memo(({roomId:s,userId:r,nickname:c,uniqueId:o,isActive:i})=>{const[a,d]=n.exports.useState(!1);n.exports.useEffect(()=>{i||d(!1)},[i]);const l=n.exports.useCallback(()=>{d(!1)},[]),{videoStream:t,videoStreamMap:e}=b(s,r,a?"SCREEN":null,l,o),h=x(s,r);return f("div",{className:"MeetingScreen-container",children:[f("div",{className:"MeetingScreen-toolbar",children:[a&&p("button",{type:"button",onClick:l,children:"Stop sharing"}),!a&&p("button",{type:"button",onClick:()=>d(!0),disabled:!i,children:"Start Screen Share"})]}),i&&f("div",{className:"MeetingScreen-body",children:[t&&p(S,{nickname:c,stream:t}),Object.keys(e).map(u=>{const m=e[u];return m?p(S,{nickname:h[u]||"No Name",stream:m},u):null})]})]})});export{y as MeetingScreen,y as default};
